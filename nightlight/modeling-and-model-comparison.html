<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Modeling and model comparison | Exploring Nighttime lights in the U.S. Southeast</title>
  <meta name="description" content="3 Modeling and model comparison | Exploring Nighttime lights in the U.S. Southeast" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Modeling and model comparison | Exploring Nighttime lights in the U.S. Southeast" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Modeling and model comparison | Exploring Nighttime lights in the U.S. Southeast" />
  
  
  

<meta name="author" content="Daniel Moul" />


<meta name="date" content="2021-08-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exploratory-data-analysis.html"/>
<link rel="next" href="interpreting-the-results.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Exploring Nighttime Lights</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#questions"><i class="fa fa-check"></i><b>1.1</b> Questions</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#method"><i class="fa fa-check"></i><b>1.2</b> Method</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#causal-assumptions"><i class="fa fa-check"></i><b>1.3</b> Causal assumptions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>2</b> Exploratory data analysis</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#map"><i class="fa fa-check"></i><b>2.1</b> Map</a></li>
<li class="chapter" data-level="2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-for-modeling"><i class="fa fa-check"></i><b>2.2</b> Data for modeling</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#predictors-and-data-transformations"><i class="fa fa-check"></i><b>2.2.1</b> Predictors and data transformations</a></li>
<li class="chapter" data-level="2.2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#radiance-values-distribution-by-state"><i class="fa fa-check"></i><b>2.2.2</b> Radiance values’ distribution by state</a></li>
<li class="chapter" data-level="2.2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#r2-and-linear-relationships-slope-estimates-by-state"><i class="fa fa-check"></i><b>2.2.3</b> <span class="math inline">\(R^2\)</span> and linear relationships: slope estimates by state</a></li>
<li class="chapter" data-level="2.2.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#eda-summary-comments"><i class="fa fa-check"></i><b>2.2.4</b> EDA summary comments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html"><i class="fa fa-check"></i><b>3</b> Modeling and model comparison</a>
<ul>
<li class="chapter" data-level="3.1" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#train-and-test-on-training-data-set"><i class="fa fa-check"></i><b>3.1</b> Train and test on training data set</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#lin1-light_avg-pop_density"><i class="fa fa-check"></i><b>3.1.1</b> lin1: light_avg ~ pop_density</a></li>
<li class="chapter" data-level="3.1.2" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#lin2-light_avg-pop_density_official"><i class="fa fa-check"></i><b>3.1.2</b> lin2: light_avg ~ pop_density_official</a></li>
<li class="chapter" data-level="3.1.3" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#lin3-log_light_avg-log_pop_density"><i class="fa fa-check"></i><b>3.1.3</b> lin3: log_light_avg ~ log_pop_density</a></li>
<li class="chapter" data-level="3.1.4" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#pol1-log_light_avg-polylog_pop_density-2"><i class="fa fa-check"></i><b>3.1.4</b> pol1: log_light_avg ~ poly(log_pop_density, 2)</a></li>
<li class="chapter" data-level="3.1.5" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#lme1-multi-level-model-with-lme4lmer"><i class="fa fa-check"></i><b>3.1.5</b> lme1: multi-level model with <span>lme4::lmer</span></a></li>
<li class="chapter" data-level="3.1.6" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#bs1-linear-model-with-b-spline"><i class="fa fa-check"></i><b>3.1.6</b> bs1: linear model with b-spline</a></li>
<li class="chapter" data-level="3.1.7" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#xgboost-log_light_avg-log_pop_density-state"><i class="fa fa-check"></i><b>3.1.7</b> <span>XGBoost</span>: log_light_avg ~ log_pop_density + state</a></li>
<li class="chapter" data-level="3.1.8" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#summary-of-train-test-results"><i class="fa fa-check"></i><b>3.1.8</b> Summary of train-test results</a></li>
<li class="chapter" data-level="3.1.9" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#summary-train-test"><i class="fa fa-check"></i><b>3.1.9</b> Summary: train-test</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#assessing-model-performance-with-the-holdout-data-set"><i class="fa fa-check"></i><b>3.2</b> Assessing model performance with the holdout data set</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#summary-model-evaluation-using-holdout-data-set"><i class="fa fa-check"></i><b>3.2.1</b> Summary: model evaluation using holdout data set</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#comparing-2000-and-2010"><i class="fa fa-check"></i><b>3.3</b> Comparing 2000 and 2010</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="modeling-and-model-comparison.html"><a href="modeling-and-model-comparison.html#summary-model-performance-on-census-2010-data."><i class="fa fa-check"></i><b>3.3.1</b> Summary: model performance on census 2010 data.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="interpreting-the-results.html"><a href="interpreting-the-results.html"><i class="fa fa-check"></i><b>4</b> Interpreting the results</a>
<ul>
<li class="chapter" data-level="4.1" data-path="interpreting-the-results.html"><a href="interpreting-the-results.html#how-much-did-the-population-density-and-radiance-change-between-2000-and-2010"><i class="fa fa-check"></i><b>4.1</b> How much did the population density and radiance change between 2000 and 2010?</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="interpreting-the-results.html"><a href="interpreting-the-results.html#from-2000-to-2010-radiance-increased-almost-twice-as-much-as-population-density"><i class="fa fa-check"></i><b>4.1.1</b> From 2000 to 2010 radiance increased almost twice as much as population density</a></li>
<li class="chapter" data-level="4.1.2" data-path="interpreting-the-results.html"><a href="interpreting-the-results.html#exploring-changes-in-radiance-and-population-density-2000-and-2010"><i class="fa fa-check"></i><b>4.1.2</b> Exploring changes in radiance and population density 2000 and 2010</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="interpreting-the-results.html"><a href="interpreting-the-results.html#conclusion"><i class="fa fa-check"></i><b>4.2</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="end-notes.html"><a href="end-notes.html"><i class="fa fa-check"></i><b>5</b> End notes</a>
<ul>
<li class="chapter" data-level="5.1" data-path="end-notes.html"><a href="end-notes.html#acknowlegements"><i class="fa fa-check"></i><b>5.1</b> Acknowlegements</a></li>
<li class="chapter" data-level="5.2" data-path="end-notes.html"><a href="end-notes.html#data-provenance"><i class="fa fa-check"></i><b>5.2</b> Data provenance</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="end-notes.html"><a href="end-notes.html#version-4-dmsp-ols-nighttime-lights-time-series"><i class="fa fa-check"></i><b>5.2.1</b> Version 4 DMSP-OLS Nighttime Lights Time Series</a></li>
<li class="chapter" data-level="5.2.2" data-path="end-notes.html"><a href="end-notes.html#radiance-data"><i class="fa fa-check"></i><b>5.2.2</b> Radiance data</a></li>
<li class="chapter" data-level="5.2.3" data-path="end-notes.html"><a href="end-notes.html#intercalibration"><i class="fa fa-check"></i><b>5.2.3</b> Intercalibration</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="end-notes.html"><a href="end-notes.html#assumptions-and-limitations"><i class="fa fa-check"></i><b>5.3</b> Assumptions and limitations</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="end-notes.html"><a href="end-notes.html#limitations"><i class="fa fa-check"></i><b>5.3.1</b> Limitations</a></li>
<li class="chapter" data-level="5.3.2" data-path="end-notes.html"><a href="end-notes.html#census-data-and-state-and-county-geometry"><i class="fa fa-check"></i><b>5.3.2</b> Census data and state and county geometry</a></li>
<li class="chapter" data-level="5.3.3" data-path="end-notes.html"><a href="end-notes.html#population-and-population-density"><i class="fa fa-check"></i><b>5.3.3</b> Population and population density</a></li>
<li class="chapter" data-level="5.3.4" data-path="end-notes.html"><a href="end-notes.html#economic-development-gdp-business-cycle"><i class="fa fa-check"></i><b>5.3.4</b> Economic development / GDP / business cycle</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="end-notes.html"><a href="end-notes.html#project-organization"><i class="fa fa-check"></i><b>5.4</b> Project organization</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="end-notes.html"><a href="end-notes.html#data-preparation-pipeline-implemented-to-with-targets-package"><i class="fa fa-check"></i><b>5.4.1</b> Data preparation pipeline implemented to with targets package</a></li>
<li class="chapter" data-level="5.4.2" data-path="end-notes.html"><a href="end-notes.html#session-information"><i class="fa fa-check"></i><b>5.4.2</b> Session information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exploring Nighttime lights in the U.S. Southeast</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modeling-and-model-comparison" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Modeling and model comparison</h1>
<p>As noted in the EDA section:</p>
<p>The relationship between <span class="math inline">\(log_{10}(light\_avg)\)</span> and <span class="math inline">\(log_{10}(pop\_density)\)</span> in figures <a href="exploratory-data-analysis.html#fig:pop-density-light-avg-loglog-scatter">2.4</a> and <a href="exploratory-data-analysis.html#fig:pop-density-light-avg-loglog-facet-scatter">2.5</a>) isn’t quite linear. The plots suggest a concave curve (a second order polynomial), and there are differences by state. So I expect simple linear models to perform worse than more sophisticated ones. Nonetheless, I want to see how good linear models are, since they <em>are</em> simple and inexpensive.</p>
<p>In this section I do the following:</p>
<ul>
<li>Prepare train-test and holdout data sets</li>
<li>Build (and where necessary, train) some models, then compare them using performance metrics</li>
<li>Test the best performing models against the holdout data set.</li>
</ul>
<p>I use the following performance metrics:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Concordance_correlation_coefficien">Concordance correlation coefficient</a> (ccc) according the help for <code>yardstick::ccc()</code> “is a metric of both consistency/correlation and accuracy,”</li>
<li><a href="https://en.wikipedia.org/wiki/Coefficient_of_determination">R-Squared</a> according the help for <code>yardstick::rsq()</code> “is simply the squared correlation between truth and estimate” and is guaranteed to be between <span class="math inline">\((0,1)\)</span> in contrast to <code>yardstick::rsq_trad()</code> which uses the sum of squares.</li>
</ul>
<p>I use metrics that are scale-free, since I want the freedom to use models with different transformations of the data. The principle metric is <strong>ccc</strong>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="modeling-and-model-comparison.html#cb18-1" aria-hidden="true" tabindex="-1"></a>data_df <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(all_df) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="modeling-and-model-comparison.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#fix NAs</span></span>
<span id="cb18-3"><a href="modeling-and-model-comparison.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">atotal =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(atotal), atotal, calc_area),</span>
<span id="cb18-4"><a href="modeling-and-model-comparison.html#cb18-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pop_density_official =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(pop_density_official), pop_density_official, pop_density)) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="modeling-and-model-comparison.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># drop apparent data errors/artifacts</span></span>
<span id="cb18-6"><a href="modeling-and-model-comparison.html#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(light_avg <span class="sc">&gt;</span> <span class="fl">1e-5</span>)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="modeling-and-model-comparison.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data for train-test and holdout</span></span>
<span id="cb19-2"><a href="modeling-and-model-comparison.html#cb19-2" aria-hidden="true" tabindex="-1"></a>d_df_all <span class="ot">&lt;-</span> data_df <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="modeling-and-model-comparison.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(state<span class="sc">:</span>pop_density_official) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="modeling-and-model-comparison.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_diff_pct =</span> <span class="dv">1</span> <span class="sc">-</span> calc_area <span class="sc">/</span> atotal,</span>
<span id="cb19-5"><a href="modeling-and-model-comparison.html#cb19-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">pop_densisty_diff_pct =</span> <span class="dv">1</span> <span class="sc">-</span> pop_density <span class="sc">/</span> pop_density_official) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="modeling-and-model-comparison.html#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># avoid zero values</span></span>
<span id="cb19-7"><a href="modeling-and-model-comparison.html#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_light_avg =</span> <span class="fu">log10</span>(light_avg <span class="sc">+</span> <span class="fl">1e-6</span>),</span>
<span id="cb19-8"><a href="modeling-and-model-comparison.html#cb19-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_pop_density =</span> <span class="fu">log10</span>(pop_density <span class="sc">+</span> <span class="fl">1e-6</span>),</span>
<span id="cb19-9"><a href="modeling-and-model-comparison.html#cb19-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_pop_density_official =</span> <span class="fu">log10</span>(pop_density_official <span class="sc">+</span> <span class="fl">1e-6</span>))</span>
<span id="cb19-10"><a href="modeling-and-model-comparison.html#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="modeling-and-model-comparison.html#cb19-11" aria-hidden="true" tabindex="-1"></a>d_df <span class="ot">&lt;-</span> d_df_all <span class="sc">%&gt;%</span></span>
<span id="cb19-12"><a href="modeling-and-model-comparison.html#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, county, light_avg, log_light_avg, pop_density, log_pop_density, pop_density_official, log_pop_density_official)</span>
<span id="cb19-13"><a href="modeling-and-model-comparison.html#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="modeling-and-model-comparison.html#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co"># following https://cran.r-project.org/web/packages/rsample/vignettes/Working_with_rsets.html</span></span>
<span id="cb19-15"><a href="modeling-and-model-comparison.html#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb19-16"><a href="modeling-and-model-comparison.html#cb19-16" aria-hidden="true" tabindex="-1"></a>main_split <span class="ot">=</span> <span class="fu">initial_split</span>(d_df, <span class="at">strata =</span> <span class="fu">c</span>(<span class="st">&quot;state&quot;</span>))</span>
<span id="cb19-17"><a href="modeling-and-model-comparison.html#cb19-17" aria-hidden="true" tabindex="-1"></a>train_split <span class="ot">&lt;-</span> <span class="fu">analysis</span>(main_split)</span>
<span id="cb19-18"><a href="modeling-and-model-comparison.html#cb19-18" aria-hidden="true" tabindex="-1"></a>holdout <span class="ot">&lt;-</span> <span class="fu">assessment</span>(main_split)</span>
<span id="cb19-19"><a href="modeling-and-model-comparison.html#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="modeling-and-model-comparison.html#cb19-20" aria-hidden="true" tabindex="-1"></a>light_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_split, <span class="at">v =</span> n_folds, <span class="at">repeats =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="modeling-and-model-comparison.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspiration/source: Dave Robinson&#39;s coding videos</span></span>
<span id="cb20-2"><a href="modeling-and-model-comparison.html#cb20-2" aria-hidden="true" tabindex="-1"></a>prep_juice <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">juice</span>(<span class="fu">prep</span>(x))</span>
<span id="cb20-3"><a href="modeling-and-model-comparison.html#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="modeling-and-model-comparison.html#cb20-4" aria-hidden="true" tabindex="-1"></a>mset <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(rsq, ccc) <span class="co"># use scale-free metrics (not rmse)</span></span>
<span id="cb20-5"><a href="modeling-and-model-comparison.html#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="modeling-and-model-comparison.html#cb20-6" aria-hidden="true" tabindex="-1"></a>grid_control <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-7"><a href="modeling-and-model-comparison.html#cb20-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">save_workflow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-8"><a href="modeling-and-model-comparison.html#cb20-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">extract =</span> extract_model)</span>
<span id="cb20-9"><a href="modeling-and-model-comparison.html#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="modeling-and-model-comparison.html#cb20-10" aria-hidden="true" tabindex="-1"></a>augment.workflow <span class="ot">&lt;-</span> <span class="cf">function</span>(x, newdata, ...) {</span>
<span id="cb20-11"><a href="modeling-and-model-comparison.html#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(x, newdata, ...) <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="modeling-and-model-comparison.html#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(newdata)</span>
<span id="cb20-13"><a href="modeling-and-model-comparison.html#cb20-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-14"><a href="modeling-and-model-comparison.html#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="modeling-and-model-comparison.html#cb20-15" aria-hidden="true" tabindex="-1"></a>predict_on_holdout <span class="ot">&lt;-</span> <span class="cf">function</span>(workflow, tbl_train, tbl_test) {</span>
<span id="cb20-16"><a href="modeling-and-model-comparison.html#cb20-16" aria-hidden="true" tabindex="-1"></a>  workflow <span class="sc">%&gt;%</span></span>
<span id="cb20-17"><a href="modeling-and-model-comparison.html#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(tbl_train) <span class="sc">%&gt;%</span></span>
<span id="cb20-18"><a href="modeling-and-model-comparison.html#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(tbl_test)</span>
<span id="cb20-19"><a href="modeling-and-model-comparison.html#cb20-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-20"><a href="modeling-and-model-comparison.html#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="modeling-and-model-comparison.html#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># for use in fit_resamples()</span></span>
<span id="cb20-22"><a href="modeling-and-model-comparison.html#cb20-22" aria-hidden="true" tabindex="-1"></a>keep_pred <span class="ot">&lt;-</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, <span class="at">save_workflow =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><br></p>
<div id="train-and-test-on-training-data-set" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Train and test on training data set</h2>
<div id="lin1-light_avg-pop_density" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> lin1: light_avg ~ pop_density</h3>
<p>Let’s start simple. In lin1 the data is concentrated in the smaller radiance values, and the model is underestimating most high values.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="modeling-and-model-comparison.html#cb21-1" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> </span>
<span id="cb21-2"><a href="modeling-and-model-comparison.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="modeling-and-model-comparison.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;lm&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="modeling-and-model-comparison.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb21-5"><a href="modeling-and-model-comparison.html#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="modeling-and-model-comparison.html#cb21-6" aria-hidden="true" tabindex="-1"></a>my_formula <span class="ot">&lt;-</span> <span class="st">&quot;light_avg ~ pop_density + state + county&quot;</span></span>
<span id="cb21-7"><a href="modeling-and-model-comparison.html#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="modeling-and-model-comparison.html#cb21-8" aria-hidden="true" tabindex="-1"></a>lin_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb21-9"><a href="modeling-and-model-comparison.html#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">analysis</span>(light_folds<span class="sc">$</span>splits[[<span class="dv">1</span>]]),</span>
<span id="cb21-10"><a href="modeling-and-model-comparison.html#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span>  <span class="fu">as.formula</span>(my_formula)) <span class="sc">%&gt;%</span></span>
<span id="cb21-11"><a href="modeling-and-model-comparison.html#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(<span class="fu">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;county&quot;</span>), <span class="at">new_role =</span> <span class="st">&quot;id variable&quot;</span>)</span>
<span id="cb21-12"><a href="modeling-and-model-comparison.html#cb21-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-13"><a href="modeling-and-model-comparison.html#cb21-13" aria-hidden="true" tabindex="-1"></a>lin1_wf <span class="ot">&lt;-</span></span>
<span id="cb21-14"><a href="modeling-and-model-comparison.html#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-15"><a href="modeling-and-model-comparison.html#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(lin_rec) <span class="sc">%&gt;%</span></span>
<span id="cb21-16"><a href="modeling-and-model-comparison.html#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_model)</span>
<span id="cb21-17"><a href="modeling-and-model-comparison.html#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="modeling-and-model-comparison.html#cb21-18" aria-hidden="true" tabindex="-1"></a>lin1_res <span class="ot">&lt;-</span> lin1_wf <span class="sc">%&gt;%</span> </span>
<span id="cb21-19"><a href="modeling-and-model-comparison.html#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> light_folds,</span>
<span id="cb21-20"><a href="modeling-and-model-comparison.html#cb21-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">metrics =</span> mset,</span>
<span id="cb21-21"><a href="modeling-and-model-comparison.html#cb21-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> keep_pred)</span>
<span id="cb21-22"><a href="modeling-and-model-comparison.html#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="modeling-and-model-comparison.html#cb21-23" aria-hidden="true" tabindex="-1"></a>lin1_assess_res <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(lin1_res) <span class="sc">%&gt;%</span></span>
<span id="cb21-24"><a href="modeling-and-model-comparison.html#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;lin1: light_avg ~ pop_density&quot;</span>)</span>
<span id="cb21-25"><a href="modeling-and-model-comparison.html#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="modeling-and-model-comparison.html#cb21-26" aria-hidden="true" tabindex="-1"></a>lin1_metric_summary <span class="ot">&lt;-</span> lin1_assess_res <span class="sc">%&gt;%</span></span>
<span id="cb21-27"><a href="modeling-and-model-comparison.html#cb21-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">&quot;.metric&quot;</span>, <span class="at">.estimate =</span> <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;std_err&quot;</span>, <span class="st">&quot;model&quot;</span>)</span>
<span id="cb21-28"><a href="modeling-and-model-comparison.html#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="modeling-and-model-comparison.html#cb21-29" aria-hidden="true" tabindex="-1"></a>metric_summary_for_plot <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&quot;{lin1_metric_summary[[1, 1]]} = {round(lin1_metric_summary[[1, 2]], 3)}&quot;</span>,</span>
<span id="cb21-30"><a href="modeling-and-model-comparison.html#cb21-30" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {lin1_metric_summary[[2, 1]]} = {round(lin1_metric_summary[[2, 2]], 3)}&quot;</span>)</span>
<span id="cb21-31"><a href="modeling-and-model-comparison.html#cb21-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-32"><a href="modeling-and-model-comparison.html#cb21-32" aria-hidden="true" tabindex="-1"></a>lin1_pred <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(lin1_res)</span>
<span id="cb21-33"><a href="modeling-and-model-comparison.html#cb21-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-34"><a href="modeling-and-model-comparison.html#cb21-34" aria-hidden="true" tabindex="-1"></a>lin1_pred <span class="sc">%&gt;%</span></span>
<span id="cb21-35"><a href="modeling-and-model-comparison.html#cb21-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> light_avg, <span class="at">y =</span> .pred)) <span class="sc">+</span></span>
<span id="cb21-36"><a href="modeling-and-model-comparison.html#cb21-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-37"><a href="modeling-and-model-comparison.html#cb21-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb21-38"><a href="modeling-and-model-comparison.html#cb21-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{lin1_metric_summary$model}&quot;</span>),</span>
<span id="cb21-39"><a href="modeling-and-model-comparison.html#cb21-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: {metric_summary_for_plot}&quot;</span>)</span>
<span id="cb21-40"><a href="modeling-and-model-comparison.html#cb21-40" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:lin1"></span>
<img src="03-modeling_files/figure-html/lin1-1.png" alt="lin1: Simplest linear model" width="672" />
<p class="caption">
Figure 3.1: lin1: Simplest linear model
</p>
</div>
<p><br></p>
</div>
<div id="lin2-light_avg-pop_density_official" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> lin2: light_avg ~ pop_density_official</h3>
<p>Should I use official area values from the US Census Bureau to calculate population density instead of area values calculated based on the county boundaries? In a word: no. Using official area values, rsq and ccc are slightly lower than Figure <a href="modeling-and-model-comparison.html#fig:lin1">3.1</a>, perhaps because <code>pop_density</code> is calculated using the same boundaries I’m using to determine which light pixels are part of each county, and therefore I’m dealing with similar error in both. I use the area values I calculated in all other models.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="modeling-and-model-comparison.html#cb22-1" aria-hidden="true" tabindex="-1"></a>my_formula <span class="ot">&lt;-</span> <span class="st">&quot;light_avg ~ pop_density_official&quot;</span></span>
<span id="cb22-2"><a href="modeling-and-model-comparison.html#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="modeling-and-model-comparison.html#cb22-3" aria-hidden="true" tabindex="-1"></a>lin_rec2 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb22-4"><a href="modeling-and-model-comparison.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">analysis</span>(light_folds<span class="sc">$</span>splits[[<span class="dv">1</span>]]),</span>
<span id="cb22-5"><a href="modeling-and-model-comparison.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span>  <span class="fu">as.formula</span>(my_formula))</span>
<span id="cb22-6"><a href="modeling-and-model-comparison.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-7"><a href="modeling-and-model-comparison.html#cb22-7" aria-hidden="true" tabindex="-1"></a>lin2_wf <span class="ot">&lt;-</span></span>
<span id="cb22-8"><a href="modeling-and-model-comparison.html#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="modeling-and-model-comparison.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(lin_rec2) <span class="sc">%&gt;%</span></span>
<span id="cb22-10"><a href="modeling-and-model-comparison.html#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_model) <span class="co"># defined above</span></span>
<span id="cb22-11"><a href="modeling-and-model-comparison.html#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="modeling-and-model-comparison.html#cb22-12" aria-hidden="true" tabindex="-1"></a>lin2_res <span class="ot">&lt;-</span> lin2_wf <span class="sc">%&gt;%</span> </span>
<span id="cb22-13"><a href="modeling-and-model-comparison.html#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> light_folds,</span>
<span id="cb22-14"><a href="modeling-and-model-comparison.html#cb22-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">metrics =</span> mset,</span>
<span id="cb22-15"><a href="modeling-and-model-comparison.html#cb22-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> keep_pred)</span>
<span id="cb22-16"><a href="modeling-and-model-comparison.html#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="modeling-and-model-comparison.html#cb22-17" aria-hidden="true" tabindex="-1"></a>lin2_assess_res <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(lin2_res) <span class="sc">%&gt;%</span></span>
<span id="cb22-18"><a href="modeling-and-model-comparison.html#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">glue</span>(<span class="st">&quot;lin2: {my_formula}&quot;</span>))</span>
<span id="cb22-19"><a href="modeling-and-model-comparison.html#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="modeling-and-model-comparison.html#cb22-20" aria-hidden="true" tabindex="-1"></a>lin2_metric_summary <span class="ot">&lt;-</span> lin2_assess_res <span class="sc">%&gt;%</span></span>
<span id="cb22-21"><a href="modeling-and-model-comparison.html#cb22-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">&quot;.metric&quot;</span>, <span class="at">.estimate =</span> <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;std_err&quot;</span>, <span class="st">&quot;model&quot;</span>)</span>
<span id="cb22-22"><a href="modeling-and-model-comparison.html#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="modeling-and-model-comparison.html#cb22-23" aria-hidden="true" tabindex="-1"></a>metric_summary_for_plot <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&quot;{lin2_metric_summary[[1, 1]]} = {round(lin2_metric_summary[[1, 2]], 3)}&quot;</span>,</span>
<span id="cb22-24"><a href="modeling-and-model-comparison.html#cb22-24" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {lin2_metric_summary[[2, 1]]} = {round(lin2_metric_summary[[2, 2]], 3)}&quot;</span>)</span>
<span id="cb22-25"><a href="modeling-and-model-comparison.html#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="modeling-and-model-comparison.html#cb22-26" aria-hidden="true" tabindex="-1"></a>lin2_pred <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(lin2_res)</span>
<span id="cb22-27"><a href="modeling-and-model-comparison.html#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="modeling-and-model-comparison.html#cb22-28" aria-hidden="true" tabindex="-1"></a>lin2_pred <span class="sc">%&gt;%</span></span>
<span id="cb22-29"><a href="modeling-and-model-comparison.html#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> light_avg, <span class="at">y =</span> .pred)) <span class="sc">+</span></span>
<span id="cb22-30"><a href="modeling-and-model-comparison.html#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb22-31"><a href="modeling-and-model-comparison.html#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb22-32"><a href="modeling-and-model-comparison.html#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{lin2_metric_summary$model}&quot;</span>),</span>
<span id="cb22-33"><a href="modeling-and-model-comparison.html#cb22-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: {metric_summary_for_plot}&quot;</span>)</span>
<span id="cb22-34"><a href="modeling-and-model-comparison.html#cb22-34" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:lin2"></span>
<img src="03-modeling_files/figure-html/lin2-1.png" alt="lin2: Using official area values to calculate population density?" width="672" />
<p class="caption">
Figure 3.2: lin2: Using official area values to calculate population density?
</p>
</div>
</div>
<div id="lin3-log_light_avg-log_pop_density" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> lin3: log_light_avg ~ log_pop_density</h3>
<p>With both predictor and response on a log scale, performance metrics are better. Compare with lin1 in Figure <a href="modeling-and-model-comparison.html#fig:lin1">3.1</a>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="modeling-and-model-comparison.html#cb23-1" aria-hidden="true" tabindex="-1"></a>my_formula <span class="ot">&lt;-</span> <span class="st">&quot;log_light_avg ~ log_pop_density&quot;</span></span>
<span id="cb23-2"><a href="modeling-and-model-comparison.html#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="modeling-and-model-comparison.html#cb23-3" aria-hidden="true" tabindex="-1"></a>lin_rec3 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb23-4"><a href="modeling-and-model-comparison.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">analysis</span>(light_folds<span class="sc">$</span>splits[[<span class="dv">1</span>]]),</span>
<span id="cb23-5"><a href="modeling-and-model-comparison.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span>  <span class="fu">as.formula</span>(my_formula))</span>
<span id="cb23-6"><a href="modeling-and-model-comparison.html#cb23-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-7"><a href="modeling-and-model-comparison.html#cb23-7" aria-hidden="true" tabindex="-1"></a>lin3_wf <span class="ot">&lt;-</span></span>
<span id="cb23-8"><a href="modeling-and-model-comparison.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="modeling-and-model-comparison.html#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(lin_rec3) <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="modeling-and-model-comparison.html#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_model) <span class="co"># defined above</span></span>
<span id="cb23-11"><a href="modeling-and-model-comparison.html#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="modeling-and-model-comparison.html#cb23-12" aria-hidden="true" tabindex="-1"></a>lin3_res <span class="ot">&lt;-</span> lin3_wf <span class="sc">%&gt;%</span> </span>
<span id="cb23-13"><a href="modeling-and-model-comparison.html#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> light_folds,</span>
<span id="cb23-14"><a href="modeling-and-model-comparison.html#cb23-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">metrics =</span> mset,</span>
<span id="cb23-15"><a href="modeling-and-model-comparison.html#cb23-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> keep_pred)</span>
<span id="cb23-16"><a href="modeling-and-model-comparison.html#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="modeling-and-model-comparison.html#cb23-17" aria-hidden="true" tabindex="-1"></a>lin3_assess_res <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(lin3_res) <span class="sc">%&gt;%</span></span>
<span id="cb23-18"><a href="modeling-and-model-comparison.html#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">glue</span>(<span class="st">&quot;lin3: {my_formula}&quot;</span>))</span>
<span id="cb23-19"><a href="modeling-and-model-comparison.html#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="modeling-and-model-comparison.html#cb23-20" aria-hidden="true" tabindex="-1"></a>lin3_metric_summary <span class="ot">&lt;-</span> lin3_assess_res <span class="sc">%&gt;%</span></span>
<span id="cb23-21"><a href="modeling-and-model-comparison.html#cb23-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">&quot;.metric&quot;</span>, <span class="at">.estimate =</span> <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;std_err&quot;</span>, <span class="st">&quot;model&quot;</span>)</span>
<span id="cb23-22"><a href="modeling-and-model-comparison.html#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="modeling-and-model-comparison.html#cb23-23" aria-hidden="true" tabindex="-1"></a>metric_summary_for_plot <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&quot;{lin3_metric_summary[[1, 1]]} = {round(lin3_metric_summary[[1, 2]], 3)}&quot;</span>,</span>
<span id="cb23-24"><a href="modeling-and-model-comparison.html#cb23-24" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {lin3_metric_summary[[2, 1]]} = {round(lin3_metric_summary[[2, 2]], 3)}&quot;</span>)</span>
<span id="cb23-25"><a href="modeling-and-model-comparison.html#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="modeling-and-model-comparison.html#cb23-26" aria-hidden="true" tabindex="-1"></a>lin3_pred <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(lin3_res)</span>
<span id="cb23-27"><a href="modeling-and-model-comparison.html#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="modeling-and-model-comparison.html#cb23-28" aria-hidden="true" tabindex="-1"></a>lin3_pred <span class="sc">%&gt;%</span></span>
<span id="cb23-29"><a href="modeling-and-model-comparison.html#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_light_avg, <span class="at">y =</span> .pred)) <span class="sc">+</span></span>
<span id="cb23-30"><a href="modeling-and-model-comparison.html#cb23-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb23-31"><a href="modeling-and-model-comparison.html#cb23-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb23-32"><a href="modeling-and-model-comparison.html#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_obs_pred() +</span></span>
<span id="cb23-33"><a href="modeling-and-model-comparison.html#cb23-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{lin3_metric_summary$model}&quot;</span>),</span>
<span id="cb23-34"><a href="modeling-and-model-comparison.html#cb23-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: {metric_summary_for_plot}&quot;</span>)</span>
<span id="cb23-35"><a href="modeling-and-model-comparison.html#cb23-35" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:lin3"></span>
<img src="03-modeling_files/figure-html/lin3-1.png" alt="lin3: Simplest linear model with log10 transformations" width="672" />
<p class="caption">
Figure 3.3: lin3: Simplest linear model with log10 transformations
</p>
</div>
<p><br></p>
</div>
<div id="pol1-log_light_avg-polylog_pop_density-2" class="section level3" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> pol1: log_light_avg ~ poly(log_pop_density, 2)</h3>
<p>Since the data in Figure <a href="exploratory-data-analysis.html#fig:pop-density-light-avg-loglog-scatter">2.4</a> looks like it has close to a quadratic relationship (a concave curve), let’s try a second order polynomial. Performance is quite good.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="modeling-and-model-comparison.html#cb24-1" aria-hidden="true" tabindex="-1"></a>my_formula_basic <span class="ot">&lt;-</span> <span class="st">&quot;log_light_avg ~ log_pop_density&quot;</span></span>
<span id="cb24-2"><a href="modeling-and-model-comparison.html#cb24-2" aria-hidden="true" tabindex="-1"></a>my_formula <span class="ot">&lt;-</span> <span class="st">&quot;log_light_avg ~ poly(log_pop_density, 2)&quot;</span></span>
<span id="cb24-3"><a href="modeling-and-model-comparison.html#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="modeling-and-model-comparison.html#cb24-4" aria-hidden="true" tabindex="-1"></a>pol1_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb24-5"><a href="modeling-and-model-comparison.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">analysis</span>(light_folds<span class="sc">$</span>splits[[<span class="dv">1</span>]]),</span>
<span id="cb24-6"><a href="modeling-and-model-comparison.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span>  <span class="fu">as.formula</span>(my_formula_basic)) <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="modeling-and-model-comparison.html#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(log_pop_density, <span class="at">degree =</span> <span class="dv">2</span>)</span>
<span id="cb24-8"><a href="modeling-and-model-comparison.html#cb24-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-9"><a href="modeling-and-model-comparison.html#cb24-9" aria-hidden="true" tabindex="-1"></a>pol1_wf <span class="ot">&lt;-</span></span>
<span id="cb24-10"><a href="modeling-and-model-comparison.html#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-11"><a href="modeling-and-model-comparison.html#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(pol1_rec) <span class="sc">%&gt;%</span></span>
<span id="cb24-12"><a href="modeling-and-model-comparison.html#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_model) <span class="co"># defined above</span></span>
<span id="cb24-13"><a href="modeling-and-model-comparison.html#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="modeling-and-model-comparison.html#cb24-14" aria-hidden="true" tabindex="-1"></a>pol1_res <span class="ot">&lt;-</span> pol1_wf <span class="sc">%&gt;%</span> </span>
<span id="cb24-15"><a href="modeling-and-model-comparison.html#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> light_folds,</span>
<span id="cb24-16"><a href="modeling-and-model-comparison.html#cb24-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">metrics =</span> mset,</span>
<span id="cb24-17"><a href="modeling-and-model-comparison.html#cb24-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> keep_pred)</span>
<span id="cb24-18"><a href="modeling-and-model-comparison.html#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="modeling-and-model-comparison.html#cb24-19" aria-hidden="true" tabindex="-1"></a>pol1_assess_res <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(pol1_res) <span class="sc">%&gt;%</span></span>
<span id="cb24-20"><a href="modeling-and-model-comparison.html#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">glue</span>(<span class="st">&quot;pol1: {my_formula}&quot;</span>))</span>
<span id="cb24-21"><a href="modeling-and-model-comparison.html#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="modeling-and-model-comparison.html#cb24-22" aria-hidden="true" tabindex="-1"></a>pol1_metric_summary <span class="ot">&lt;-</span> pol1_assess_res <span class="sc">%&gt;%</span></span>
<span id="cb24-23"><a href="modeling-and-model-comparison.html#cb24-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">&quot;.metric&quot;</span>, <span class="at">.estimate =</span> <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;std_err&quot;</span>, <span class="st">&quot;model&quot;</span>)</span>
<span id="cb24-24"><a href="modeling-and-model-comparison.html#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="modeling-and-model-comparison.html#cb24-25" aria-hidden="true" tabindex="-1"></a>metric_summary_for_plot <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&quot;{pol1_metric_summary[[1, 1]]} = {round(pol1_metric_summary[[1, 2]], 3)}&quot;</span>,</span>
<span id="cb24-26"><a href="modeling-and-model-comparison.html#cb24-26" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {pol1_metric_summary[[2, 1]]} = {round(pol1_metric_summary[[2, 2]], 3)}&quot;</span>)</span>
<span id="cb24-27"><a href="modeling-and-model-comparison.html#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="modeling-and-model-comparison.html#cb24-28" aria-hidden="true" tabindex="-1"></a>pol1_pred <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(pol1_res)</span>
<span id="cb24-29"><a href="modeling-and-model-comparison.html#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="modeling-and-model-comparison.html#cb24-30" aria-hidden="true" tabindex="-1"></a>pol1_pred <span class="sc">%&gt;%</span></span>
<span id="cb24-31"><a href="modeling-and-model-comparison.html#cb24-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_light_avg, <span class="at">y =</span> .pred)) <span class="sc">+</span></span>
<span id="cb24-32"><a href="modeling-and-model-comparison.html#cb24-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb24-33"><a href="modeling-and-model-comparison.html#cb24-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb24-34"><a href="modeling-and-model-comparison.html#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_obs_pred() +</span></span>
<span id="cb24-35"><a href="modeling-and-model-comparison.html#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{pol1_metric_summary$model}&quot;</span>),</span>
<span id="cb24-36"><a href="modeling-and-model-comparison.html#cb24-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: {metric_summary_for_plot}&quot;</span>)</span>
<span id="cb24-37"><a href="modeling-and-model-comparison.html#cb24-37" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:pol1"></span>
<img src="03-modeling_files/figure-html/pol1-1.png" alt="pol1: Linear model with second order polynomial" width="672" />
<p class="caption">
Figure 3.4: pol1: Linear model with second order polynomial
</p>
</div>
<p><br></p>
</div>
<div id="lme1-multi-level-model-with-lme4lmer" class="section level3" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> lme1: multi-level model with <a href="https://CRAN.R-project.org/package=lme4">lme4::lmer</a></h3>
<p>Since states differ in the range and distribution of radiance values, are there improvements if I use a fixed effects model “log_light_avg ~ log_pop_density + (log_pop_density | state)?” Unfortunately not. There is no meaningful improvement over Figure <a href="modeling-and-model-comparison.html#fig:lin3">3.3</a>. Apparently <code>state</code> doesn’t seem to hold enough unique information to be helpful.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="modeling-and-model-comparison.html#cb25-1" aria-hidden="true" tabindex="-1"></a>lme_model <span class="ot">&lt;-</span> </span>
<span id="cb25-2"><a href="modeling-and-model-comparison.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="modeling-and-model-comparison.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;lmer&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="modeling-and-model-comparison.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb25-5"><a href="modeling-and-model-comparison.html#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="modeling-and-model-comparison.html#cb25-6" aria-hidden="true" tabindex="-1"></a>my_formula <span class="ot">&lt;-</span> <span class="st">&quot;log_light_avg ~ log_pop_density + (log_pop_density | state)&quot;</span></span>
<span id="cb25-7"><a href="modeling-and-model-comparison.html#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="modeling-and-model-comparison.html#cb25-8" aria-hidden="true" tabindex="-1"></a>lme1_wf <span class="ot">&lt;-</span></span>
<span id="cb25-9"><a href="modeling-and-model-comparison.html#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-10"><a href="modeling-and-model-comparison.html#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_variables</span>(<span class="at">outcomes =</span> log_light_avg,</span>
<span id="cb25-11"><a href="modeling-and-model-comparison.html#cb25-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">predictors =</span> <span class="fu">c</span>(log_pop_density, state)</span>
<span id="cb25-12"><a href="modeling-and-model-comparison.html#cb25-12" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span></span>
<span id="cb25-13"><a href="modeling-and-model-comparison.html#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(</span>
<span id="cb25-14"><a href="modeling-and-model-comparison.html#cb25-14" aria-hidden="true" tabindex="-1"></a>    lme_model,</span>
<span id="cb25-15"><a href="modeling-and-model-comparison.html#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="fu">as.formula</span>(my_formula)</span>
<span id="cb25-16"><a href="modeling-and-model-comparison.html#cb25-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-17"><a href="modeling-and-model-comparison.html#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="modeling-and-model-comparison.html#cb25-18" aria-hidden="true" tabindex="-1"></a>lme1_res <span class="ot">&lt;-</span> lme1_wf <span class="sc">%&gt;%</span> </span>
<span id="cb25-19"><a href="modeling-and-model-comparison.html#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> light_folds,</span>
<span id="cb25-20"><a href="modeling-and-model-comparison.html#cb25-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">metrics =</span> mset,</span>
<span id="cb25-21"><a href="modeling-and-model-comparison.html#cb25-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> keep_pred)</span>
<span id="cb25-22"><a href="modeling-and-model-comparison.html#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="modeling-and-model-comparison.html#cb25-23" aria-hidden="true" tabindex="-1"></a>lme1_assess_res <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(lme1_res) <span class="sc">%&gt;%</span></span>
<span id="cb25-24"><a href="modeling-and-model-comparison.html#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">glue</span>(<span class="st">&quot;lme1: {my_formula}&quot;</span>))</span>
<span id="cb25-25"><a href="modeling-and-model-comparison.html#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="modeling-and-model-comparison.html#cb25-26" aria-hidden="true" tabindex="-1"></a>lme1_metric_summary <span class="ot">&lt;-</span> lme1_assess_res <span class="sc">%&gt;%</span></span>
<span id="cb25-27"><a href="modeling-and-model-comparison.html#cb25-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">&quot;.metric&quot;</span>, <span class="at">.estimate =</span> <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;std_err&quot;</span>, <span class="st">&quot;model&quot;</span>)</span>
<span id="cb25-28"><a href="modeling-and-model-comparison.html#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="modeling-and-model-comparison.html#cb25-29" aria-hidden="true" tabindex="-1"></a>metric_summary_for_plot <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&quot;{lme1_metric_summary[[1, 1]]} = {round(lme1_metric_summary[[1, 2]], 3)}&quot;</span>,</span>
<span id="cb25-30"><a href="modeling-and-model-comparison.html#cb25-30" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;; {lme1_metric_summary[[2, 1]]} = {round(lme1_metric_summary[[2, 2]], 3)}&quot;</span>)</span>
<span id="cb25-31"><a href="modeling-and-model-comparison.html#cb25-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-32"><a href="modeling-and-model-comparison.html#cb25-32" aria-hidden="true" tabindex="-1"></a>lme1_pred <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(lme1_res)</span>
<span id="cb25-33"><a href="modeling-and-model-comparison.html#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="modeling-and-model-comparison.html#cb25-34" aria-hidden="true" tabindex="-1"></a>lme1_pred <span class="sc">%&gt;%</span></span>
<span id="cb25-35"><a href="modeling-and-model-comparison.html#cb25-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_light_avg, <span class="at">y =</span> .pred)) <span class="sc">+</span></span>
<span id="cb25-36"><a href="modeling-and-model-comparison.html#cb25-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb25-37"><a href="modeling-and-model-comparison.html#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb25-38"><a href="modeling-and-model-comparison.html#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb25-39"><a href="modeling-and-model-comparison.html#cb25-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{lme1_metric_summary$model}&quot;</span>),</span>
<span id="cb25-40"><a href="modeling-and-model-comparison.html#cb25-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: {metric_summary_for_plot}&quot;</span>)</span>
<span id="cb25-41"><a href="modeling-and-model-comparison.html#cb25-41" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:lme1"></span>
<img src="03-modeling_files/figure-html/lme1-1.png" alt="lme1: Multi-level model using 'state'" width="672" />
<p class="caption">
Figure 3.5: lme1: Multi-level model using ‘state’
</p>
</div>
<p><br></p>
</div>
<div id="bs1-linear-model-with-b-spline" class="section level3" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> bs1: linear model with b-spline</h3>
<p>Since Figure <a href="modeling-and-model-comparison.html#fig:lin3">3.3</a> seems to be underestimating high and low radiance, let’s try a spline. First I tune the model to determine how many knots to include in the spline:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="modeling-and-model-comparison.html#cb26-1" aria-hidden="true" tabindex="-1"></a>bs_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(log_light_avg <span class="sc">~</span> log_pop_density,</span>
<span id="cb26-2"><a href="modeling-and-model-comparison.html#cb26-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> <span class="fu">analysis</span>(light_folds<span class="sc">$</span>splits[[<span class="dv">1</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="modeling-and-model-comparison.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_ns</span>(log_pop_density, <span class="at">deg_free =</span> <span class="fu">tune</span>(<span class="st">&quot;log_pop_density&quot;</span>))</span>
<span id="cb26-4"><a href="modeling-and-model-comparison.html#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="modeling-and-model-comparison.html#cb26-5" aria-hidden="true" tabindex="-1"></a>bs_model <span class="ot">&lt;-</span> </span>
<span id="cb26-6"><a href="modeling-and-model-comparison.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="modeling-and-model-comparison.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;lm&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-8"><a href="modeling-and-model-comparison.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb26-9"><a href="modeling-and-model-comparison.html#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="modeling-and-model-comparison.html#cb26-10" aria-hidden="true" tabindex="-1"></a>my_formula <span class="ot">=</span> <span class="st">&quot;log_light_avg ~ bs(log_pop_density)&quot;</span></span>
<span id="cb26-11"><a href="modeling-and-model-comparison.html#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="modeling-and-model-comparison.html#cb26-12" aria-hidden="true" tabindex="-1"></a>bs1_wf <span class="ot">&lt;-</span></span>
<span id="cb26-13"><a href="modeling-and-model-comparison.html#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-14"><a href="modeling-and-model-comparison.html#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(bs_rec) <span class="sc">%&gt;%</span></span>
<span id="cb26-15"><a href="modeling-and-model-comparison.html#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(bs_model) </span>
<span id="cb26-16"><a href="modeling-and-model-comparison.html#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="modeling-and-model-comparison.html#cb26-17" aria-hidden="true" tabindex="-1"></a>k_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">log_pop_density =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb26-18"><a href="modeling-and-model-comparison.html#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="modeling-and-model-comparison.html#cb26-19" aria-hidden="true" tabindex="-1"></a>bs_tune <span class="ot">&lt;-</span> bs1_wf <span class="sc">%&gt;%</span></span>
<span id="cb26-20"><a href="modeling-and-model-comparison.html#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> light_folds,</span>
<span id="cb26-21"><a href="modeling-and-model-comparison.html#cb26-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> k_grid,</span>
<span id="cb26-22"><a href="modeling-and-model-comparison.html#cb26-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> mset,</span>
<span id="cb26-23"><a href="modeling-and-model-comparison.html#cb26-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> grid_control)</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="modeling-and-model-comparison.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(bs_tune) <span class="sc">+</span></span>
<span id="cb27-2"><a href="modeling-and-model-comparison.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuning bs1&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:bs1-autoplot"></span>
<img src="03-modeling_files/figure-html/bs1-autoplot-1.png" alt="Tuning bs1" width="672" />
<p class="caption">
Figure 3.6: Tuning bs1
</p>
</div>
<p><br></p>
<p>I’ll use 5 knots, which maximizes both ccc and rsq (though the differences are marginal)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="modeling-and-model-comparison.html#cb28-1" aria-hidden="true" tabindex="-1"></a>bs_wf_best <span class="ot">&lt;-</span> bs1_wf <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="modeling-and-model-comparison.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(<span class="fu">select_best</span>(bs_tune, <span class="at">metric =</span> <span class="st">&quot;ccc&quot;</span>))</span>
<span id="cb28-3"><a href="modeling-and-model-comparison.html#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="modeling-and-model-comparison.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select_best</span>(bs_tune, <span class="at">metric =</span> <span class="st">&quot;ccc&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="modeling-and-model-comparison.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code></pre></div>
<div id="yvdakhldif" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#yvdakhldif .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yvdakhldif .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yvdakhldif .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yvdakhldif .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yvdakhldif .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yvdakhldif .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yvdakhldif .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yvdakhldif .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yvdakhldif .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yvdakhldif .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yvdakhldif .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yvdakhldif .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#yvdakhldif .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yvdakhldif .gt_from_md > :first-child {
  margin-top: 0;
}

#yvdakhldif .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yvdakhldif .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yvdakhldif .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#yvdakhldif .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yvdakhldif .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#yvdakhldif .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yvdakhldif .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yvdakhldif .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yvdakhldif .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yvdakhldif .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yvdakhldif .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#yvdakhldif .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yvdakhldif .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#yvdakhldif .gt_left {
  text-align: left;
}

#yvdakhldif .gt_center {
  text-align: center;
}

#yvdakhldif .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yvdakhldif .gt_font_normal {
  font-weight: normal;
}

#yvdakhldif .gt_font_bold {
  font-weight: bold;
}

#yvdakhldif .gt_font_italic {
  font-style: italic;
}

#yvdakhldif .gt_super {
  font-size: 65%;
}

#yvdakhldif .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">log_pop_density</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.config</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">5</td>
<td class="gt_row gt_left">Preprocessor3_Model1</td></tr>
  </tbody>
  
  
</table>
</div>
<p><br></p>
<p>Both ccc and rsq are better, and the high and low predictions are not consistently underestimated:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="modeling-and-model-comparison.html#cb29-1" aria-hidden="true" tabindex="-1"></a>bs1_res <span class="ot">&lt;-</span> bs_wf_best <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="modeling-and-model-comparison.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> light_folds,</span>
<span id="cb29-3"><a href="modeling-and-model-comparison.html#cb29-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">metrics =</span> mset,</span>
<span id="cb29-4"><a href="modeling-and-model-comparison.html#cb29-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> keep_pred)</span>
<span id="cb29-5"><a href="modeling-and-model-comparison.html#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="modeling-and-model-comparison.html#cb29-6" aria-hidden="true" tabindex="-1"></a>bs1_assess_res <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(bs1_res) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="modeling-and-model-comparison.html#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">glue</span>(<span class="st">&quot;bs1: {my_formula}&quot;</span>))</span>
<span id="cb29-8"><a href="modeling-and-model-comparison.html#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="modeling-and-model-comparison.html#cb29-9" aria-hidden="true" tabindex="-1"></a>bs1_metric_summary <span class="ot">&lt;-</span> bs1_assess_res <span class="sc">%&gt;%</span></span>
<span id="cb29-10"><a href="modeling-and-model-comparison.html#cb29-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">&quot;.metric&quot;</span>, <span class="at">.estimate =</span> <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;std_err&quot;</span>, <span class="st">&quot;model&quot;</span>)</span>
<span id="cb29-11"><a href="modeling-and-model-comparison.html#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="modeling-and-model-comparison.html#cb29-12" aria-hidden="true" tabindex="-1"></a>metric_summary_for_plot <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&quot;{bs1_metric_summary[[1, 1]]} = {round(bs1_metric_summary[[1, 2]], 3)}&quot;</span>,</span>
<span id="cb29-13"><a href="modeling-and-model-comparison.html#cb29-13" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;; {bs1_metric_summary[[2, 1]]} = {round(bs1_metric_summary[[2, 2]], 3)}&quot;</span>)</span>
<span id="cb29-14"><a href="modeling-and-model-comparison.html#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="modeling-and-model-comparison.html#cb29-15" aria-hidden="true" tabindex="-1"></a>bs1_pred <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(bs1_res)</span>
<span id="cb29-16"><a href="modeling-and-model-comparison.html#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="modeling-and-model-comparison.html#cb29-17" aria-hidden="true" tabindex="-1"></a>bs1_pred <span class="sc">%&gt;%</span></span>
<span id="cb29-18"><a href="modeling-and-model-comparison.html#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_light_avg, <span class="at">y =</span> .pred)) <span class="sc">+</span></span>
<span id="cb29-19"><a href="modeling-and-model-comparison.html#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb29-20"><a href="modeling-and-model-comparison.html#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb29-21"><a href="modeling-and-model-comparison.html#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb29-22"><a href="modeling-and-model-comparison.html#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{bs1_metric_summary$model}&quot;</span>),</span>
<span id="cb29-23"><a href="modeling-and-model-comparison.html#cb29-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: {metric_summary_for_plot}&quot;</span>)</span>
<span id="cb29-24"><a href="modeling-and-model-comparison.html#cb29-24" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:bs1"></span>
<img src="03-modeling_files/figure-html/bs1-1.png" alt="bs1: linear model with B-spline (five knots) to capture curvature" width="672" />
<p class="caption">
Figure 3.7: bs1: linear model with B-spline (five knots) to capture curvature
</p>
</div>
<p><br></p>
</div>
<div id="xgboost-log_light_avg-log_pop_density-state" class="section level3" number="3.1.7">
<h3><span class="header-section-number">3.1.7</span> <a href="https://xgboost.readthedocs.io/en/latest/tutorials/model.html">XGBoost</a>: log_light_avg ~ log_pop_density + state</h3>
<p>Now a non-linear model and one that needs training: boosted trees using XGBoost. In this model <code>state</code> categories are dummy variables.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="modeling-and-model-comparison.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2021</span>)</span>
<span id="cb30-2"><a href="modeling-and-model-comparison.html#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="modeling-and-model-comparison.html#cb30-3" aria-hidden="true" tabindex="-1"></a>xg_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(log_light_avg <span class="sc">~</span> log_pop_density <span class="sc">+</span> state,</span>
<span id="cb30-4"><a href="modeling-and-model-comparison.html#cb30-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> <span class="fu">analysis</span>(light_folds<span class="sc">$</span>splits[[<span class="dv">1</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="modeling-and-model-comparison.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(state)</span>
<span id="cb30-6"><a href="modeling-and-model-comparison.html#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="modeling-and-model-comparison.html#cb30-7" aria-hidden="true" tabindex="-1"></a>xg_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="modeling-and-model-comparison.html#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(xg_rec) <span class="sc">%&gt;%</span></span>
<span id="cb30-9"><a href="modeling-and-model-comparison.html#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(<span class="fu">boost_tree</span>(<span class="at">mode =</span> <span class="st">&quot;regression&quot;</span>,</span>
<span id="cb30-10"><a href="modeling-and-model-comparison.html#cb30-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mtry =</span> <span class="fu">tune</span>(),</span>
<span id="cb30-11"><a href="modeling-and-model-comparison.html#cb30-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">trees =</span> <span class="fu">tune</span>(),</span>
<span id="cb30-12"><a href="modeling-and-model-comparison.html#cb30-12" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># tree_depth = , # default is 6</span></span>
<span id="cb30-13"><a href="modeling-and-model-comparison.html#cb30-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">learn_rate =</span> .<span class="dv">01</span>) <span class="sc">%&gt;%</span> <span class="fu">set_engine</span>(<span class="st">&quot;xgboost&quot;</span>))</span>
<span id="cb30-14"><a href="modeling-and-model-comparison.html#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="modeling-and-model-comparison.html#cb30-15" aria-hidden="true" tabindex="-1"></a>xg_tune <span class="ot">&lt;-</span> xg_wf <span class="sc">%&gt;%</span></span>
<span id="cb30-16"><a href="modeling-and-model-comparison.html#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(light_folds,</span>
<span id="cb30-17"><a href="modeling-and-model-comparison.html#cb30-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> <span class="fu">crossing</span>(<span class="at">mtry =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>),</span>
<span id="cb30-18"><a href="modeling-and-model-comparison.html#cb30-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">trees =</span> <span class="fu">seq</span>(<span class="dv">50</span>, <span class="dv">400</span>, <span class="dv">50</span>),</span>
<span id="cb30-19"><a href="modeling-and-model-comparison.html#cb30-19" aria-hidden="true" tabindex="-1"></a>                       <span class="co">#threshold = c(0.01) # default is 0.01</span></span>
<span id="cb30-20"><a href="modeling-and-model-comparison.html#cb30-20" aria-hidden="true" tabindex="-1"></a>                       ),</span>
<span id="cb30-21"><a href="modeling-and-model-comparison.html#cb30-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> mset,</span>
<span id="cb30-22"><a href="modeling-and-model-comparison.html#cb30-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> grid_control)</span></code></pre></div>
<p>Tuning the model …. results suggest using between 200 and 400 trees with equal performance including 8 or 11 variables at each split:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="modeling-and-model-comparison.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(xg_tune) <span class="sc">+</span></span>
<span id="cb31-2"><a href="modeling-and-model-comparison.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuning xg1&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:xg1-autoplot"></span>
<img src="03-modeling_files/figure-html/xg1-autoplot-1.png" alt="Tuning xg1" width="672" />
<p class="caption">
Figure 3.8: Tuning xg1
</p>
</div>
<p><br></p>
<p>The best fit includes 400 trees and using <span class="math inline">\(mtry = 8\)</span> to randomly sample 8 variables at each split (which is nearly all of them in this case). The benefit of 400 trees versus 300 is very small, and given we have ~650 data points for training (before considering cv folds), I use the lesser number. Fewer trees reduces the chance of overfitting.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="modeling-and-model-comparison.html#cb32-1" aria-hidden="true" tabindex="-1"></a>xg_wf_best <span class="ot">&lt;-</span> xg_wf <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="modeling-and-model-comparison.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(<span class="fu">select_best</span>(xg_tune, <span class="at">metric =</span> <span class="st">&quot;ccc&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="modeling-and-model-comparison.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_model</span>(<span class="fu">boost_tree</span>(<span class="at">mode =</span> <span class="st">&quot;regression&quot;</span>,</span>
<span id="cb32-4"><a href="modeling-and-model-comparison.html#cb32-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mtry =</span> <span class="dv">8</span>,</span>
<span id="cb32-5"><a href="modeling-and-model-comparison.html#cb32-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">trees =</span> <span class="dv">300</span>,</span>
<span id="cb32-6"><a href="modeling-and-model-comparison.html#cb32-6" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># tree_depth = 3,</span></span>
<span id="cb32-7"><a href="modeling-and-model-comparison.html#cb32-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">learn_rate =</span> .<span class="dv">01</span>) <span class="sc">%&gt;%</span> <span class="fu">set_engine</span>(<span class="st">&quot;xgboost&quot;</span>))</span></code></pre></div>
<p><br></p>
<p>So I use these:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="modeling-and-model-comparison.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(xg_wf_best)</span></code></pre></div>
<pre><code>## ══ Workflow ═════════════════════════════════════════════════════════════════════
## Preprocessor: Recipe
## Model: boost_tree()
## 
## ── Preprocessor ─────────────────────────────────────────────────────────────────
## 1 Recipe Step
## 
## • step_dummy()
## 
## ── Model ────────────────────────────────────────────────────────────────────────
## Boosted Tree Model Specification (regression)
## 
## Main Arguments:
##   mtry = 8
##   trees = 300
##   learn_rate = 0.01
## 
## Computational engine: xgboost</code></pre>
<p><br></p>
<p>Summary metrics are good, however the model is underestimating high radiance values:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="modeling-and-model-comparison.html#cb35-1" aria-hidden="true" tabindex="-1"></a>my_formula <span class="ot">&lt;-</span> <span class="st">&quot;log_light_avg ~ log_pop_density + state&quot;</span></span>
<span id="cb35-2"><a href="modeling-and-model-comparison.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="modeling-and-model-comparison.html#cb35-3" aria-hidden="true" tabindex="-1"></a>xg_fit_best <span class="ot">&lt;-</span> xg_wf_best <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="modeling-and-model-comparison.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(train_split) <span class="co"># </span><span class="al">TODO</span><span class="co">: confirm I should be using full train-test set now that it&#39;s tuned </span></span>
<span id="cb35-5"><a href="modeling-and-model-comparison.html#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="modeling-and-model-comparison.html#cb35-6" aria-hidden="true" tabindex="-1"></a>xg1_res <span class="ot">&lt;-</span> xg_fit_best <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="modeling-and-model-comparison.html#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(main_split, <span class="at">metrics =</span> mset)</span>
<span id="cb35-8"><a href="modeling-and-model-comparison.html#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="modeling-and-model-comparison.html#cb35-9" aria-hidden="true" tabindex="-1"></a>xg1_assess_res <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(xg1_res) <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="modeling-and-model-comparison.html#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">glue</span>(<span class="st">&quot;xg1: {my_formula}&quot;</span>))</span>
<span id="cb35-11"><a href="modeling-and-model-comparison.html#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="modeling-and-model-comparison.html#cb35-12" aria-hidden="true" tabindex="-1"></a>xg1_metric_summary <span class="ot">&lt;-</span> xg1_assess_res <span class="sc">%&gt;%</span></span>
<span id="cb35-13"><a href="modeling-and-model-comparison.html#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> n_folds,</span>
<span id="cb35-14"><a href="modeling-and-model-comparison.html#cb35-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">std_err =</span> <span class="cn">NA_real_</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-15"><a href="modeling-and-model-comparison.html#cb35-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(.metric, .estimate, n, std_err, model)</span>
<span id="cb35-16"><a href="modeling-and-model-comparison.html#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="modeling-and-model-comparison.html#cb35-17" aria-hidden="true" tabindex="-1"></a>metric_summary_for_plot <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&quot;{xg1_metric_summary[[2, 1]]} = {round(xg1_metric_summary[[2, 2]], 3)}&quot;</span>,</span>
<span id="cb35-18"><a href="modeling-and-model-comparison.html#cb35-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {xg1_metric_summary[[1, 1]]} = {round(xg1_metric_summary[[1, 2]], 3)}&quot;</span>)</span>
<span id="cb35-19"><a href="modeling-and-model-comparison.html#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="modeling-and-model-comparison.html#cb35-20" aria-hidden="true" tabindex="-1"></a>xg1_pred <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(xg1_res)</span>
<span id="cb35-21"><a href="modeling-and-model-comparison.html#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="modeling-and-model-comparison.html#cb35-22" aria-hidden="true" tabindex="-1"></a>xg1_pred <span class="sc">%&gt;%</span></span>
<span id="cb35-23"><a href="modeling-and-model-comparison.html#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_light_avg, <span class="at">y =</span> .pred)) <span class="sc">+</span></span>
<span id="cb35-24"><a href="modeling-and-model-comparison.html#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-25"><a href="modeling-and-model-comparison.html#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb35-26"><a href="modeling-and-model-comparison.html#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb35-27"><a href="modeling-and-model-comparison.html#cb35-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{xg1_metric_summary$model}&quot;</span>),</span>
<span id="cb35-28"><a href="modeling-and-model-comparison.html#cb35-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: {metric_summary_for_plot}&quot;</span>)</span>
<span id="cb35-29"><a href="modeling-and-model-comparison.html#cb35-29" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:xg1"></span>
<img src="03-modeling_files/figure-html/xg1-1.png" alt="xg1: Random forest with boosted graidient descent" width="672" />
<p class="caption">
Figure 3.9: xg1: Random forest with boosted graidient descent
</p>
</div>
<p><br></p>
</div>
<div id="summary-of-train-test-results" class="section level3" number="3.1.8">
<h3><span class="header-section-number">3.1.8</span> Summary of train-test results</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="modeling-and-model-comparison.html#cb36-1" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb36-2"><a href="modeling-and-model-comparison.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  lin1_metric_summary,</span>
<span id="cb36-3"><a href="modeling-and-model-comparison.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  lin2_metric_summary,</span>
<span id="cb36-4"><a href="modeling-and-model-comparison.html#cb36-4" aria-hidden="true" tabindex="-1"></a>  lin3_metric_summary,</span>
<span id="cb36-5"><a href="modeling-and-model-comparison.html#cb36-5" aria-hidden="true" tabindex="-1"></a>  pol1_metric_summary,</span>
<span id="cb36-6"><a href="modeling-and-model-comparison.html#cb36-6" aria-hidden="true" tabindex="-1"></a>  xg1_metric_summary,</span>
<span id="cb36-7"><a href="modeling-and-model-comparison.html#cb36-7" aria-hidden="true" tabindex="-1"></a>  lme1_metric_summary,</span>
<span id="cb36-8"><a href="modeling-and-model-comparison.html#cb36-8" aria-hidden="true" tabindex="-1"></a>  bs1_metric_summary,</span>
<span id="cb36-9"><a href="modeling-and-model-comparison.html#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb36-10"><a href="modeling-and-model-comparison.html#cb36-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="modeling-and-model-comparison.html#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ccc&quot;</span>, <span class="st">&quot;rsq&quot;</span>))</span>
<span id="cb36-12"><a href="modeling-and-model-comparison.html#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="modeling-and-model-comparison.html#cb36-13" aria-hidden="true" tabindex="-1"></a>model_levels <span class="ot">=</span> all_metrics <span class="sc">%&gt;%</span></span>
<span id="cb36-14"><a href="modeling-and-model-comparison.html#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;ccc&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-15"><a href="modeling-and-model-comparison.html#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(.estimate) <span class="sc">%&gt;%</span></span>
<span id="cb36-16"><a href="modeling-and-model-comparison.html#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(model)</span>
<span id="cb36-17"><a href="modeling-and-model-comparison.html#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="modeling-and-model-comparison.html#cb36-18" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="sc">%&gt;%</span></span>
<span id="cb36-19"><a href="modeling-and-model-comparison.html#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_levels)) <span class="sc">%&gt;%</span></span>
<span id="cb36-20"><a href="modeling-and-model-comparison.html#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(.estimate, model)) <span class="sc">+</span></span>
<span id="cb36-21"><a href="modeling-and-model-comparison.html#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmax =</span> .estimate <span class="sc">+</span> std_err, <span class="at">xmin =</span> .estimate <span class="sc">-</span> std_err),</span>
<span id="cb36-22"><a href="modeling-and-model-comparison.html#cb36-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb36-23"><a href="modeling-and-model-comparison.html#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-24"><a href="modeling-and-model-comparison.html#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fl">1.0</span>) <span class="sc">+</span></span>
<span id="cb36-25"><a href="modeling-and-model-comparison.html#cb36-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> .metric, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-26"><a href="modeling-and-model-comparison.html#cb36-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-27"><a href="modeling-and-model-comparison.html#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;Comparing model performance for metrics &quot;</span>,</span>
<span id="cb36-28"><a href="modeling-and-model-comparison.html#cb36-28" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;{glue_collapse(sort(unique(all_metrics$.metric)), sep = &#39;, &#39;)}&quot;</span>),</span>
<span id="cb36-29"><a href="modeling-and-model-comparison.html#cb36-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Performance on train-test set&quot;</span>,</span>
<span id="cb36-30"><a href="modeling-and-model-comparison.html#cb36-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;mean metric estimate across all folds; error bars +/- std_err&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:summary-train-test-plot"></span>
<img src="03-modeling_files/figure-html/summary-train-test-plot-1.png" alt="Summary of train-test results" width="768" />
<p class="caption">
Figure 3.10: Summary of train-test results
</p>
</div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="modeling-and-model-comparison.html#cb37-1" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="modeling-and-model-comparison.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(.metric, <span class="fu">desc</span>(.estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="modeling-and-model-comparison.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="modeling-and-model-comparison.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb37-5"><a href="modeling-and-model-comparison.html#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">md</span>(<span class="st">&quot;**Model evaluation on train-test data set**&quot;</span>)</span>
<span id="cb37-6"><a href="modeling-and-model-comparison.html#cb37-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="modeling-and-model-comparison.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(.estimate, std_err),</span>
<span id="cb37-8"><a href="modeling-and-model-comparison.html#cb37-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">decimals =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="modeling-and-model-comparison.html#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_missing</span>(<span class="at">columns =</span> <span class="fu">everything</span>(),</span>
<span id="cb37-10"><a href="modeling-and-model-comparison.html#cb37-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">missing_text =</span> <span class="st">&quot;---&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-11"><a href="modeling-and-model-comparison.html#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_align</span>(<span class="at">columns =</span> model, <span class="at">align =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<div id="wtekawcftw" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wtekawcftw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wtekawcftw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wtekawcftw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wtekawcftw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wtekawcftw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wtekawcftw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wtekawcftw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wtekawcftw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wtekawcftw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wtekawcftw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wtekawcftw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wtekawcftw .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wtekawcftw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wtekawcftw .gt_from_md > :first-child {
  margin-top: 0;
}

#wtekawcftw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wtekawcftw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wtekawcftw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wtekawcftw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wtekawcftw .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wtekawcftw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wtekawcftw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wtekawcftw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wtekawcftw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wtekawcftw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wtekawcftw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wtekawcftw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wtekawcftw .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wtekawcftw .gt_left {
  text-align: left;
}

#wtekawcftw .gt_center {
  text-align: center;
}

#wtekawcftw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wtekawcftw .gt_font_normal {
  font-weight: normal;
}

#wtekawcftw .gt_font_bold {
  font-weight: bold;
}

#wtekawcftw .gt_font_italic {
  font-style: italic;
}

#wtekawcftw .gt_super {
  font-size: 65%;
}

#wtekawcftw .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border" style><strong>Model evaluation on train-test data set</strong></th>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.metric</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">std_err</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">model</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.962</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">&mdash;</td>
<td class="gt_row gt_left">xg1: log_light_avg ~ log_pop_density + state</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.959</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.004</td>
<td class="gt_row gt_left">bs1: log_light_avg ~ bs(log_pop_density)</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.957</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.004</td>
<td class="gt_row gt_left">pol1: log_light_avg ~ poly(log_pop_density, 2)</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.947</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.004</td>
<td class="gt_row gt_left">lin3: log_light_avg ~ log_pop_density</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.945</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.004</td>
<td class="gt_row gt_left">lme1: log_light_avg ~ log_pop_density + (log_pop_density | state)</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.907</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.013</td>
<td class="gt_row gt_left">lin1: light_avg ~ pop_density</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.881</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.030</td>
<td class="gt_row gt_left">lin2: light_avg ~ pop_density_official</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.956</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">&mdash;</td>
<td class="gt_row gt_left">xg1: log_light_avg ~ log_pop_density + state</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.953</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.007</td>
<td class="gt_row gt_left">bs1: log_light_avg ~ bs(log_pop_density)</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.951</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.008</td>
<td class="gt_row gt_left">pol1: log_light_avg ~ poly(log_pop_density, 2)</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.931</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.008</td>
<td class="gt_row gt_left">lin3: log_light_avg ~ log_pop_density</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.931</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.008</td>
<td class="gt_row gt_left">lme1: log_light_avg ~ log_pop_density + (log_pop_density | state)</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.931</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.020</td>
<td class="gt_row gt_left">lin1: light_avg ~ pop_density</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.922</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_right">0.022</td>
<td class="gt_row gt_left">lin2: light_avg ~ pop_density_official</td></tr>
  </tbody>
  
  
</table>
</div>
<p><br></p>
</div>
<div id="summary-train-test" class="section level3" number="3.1.9">
<h3><span class="header-section-number">3.1.9</span> Summary: train-test</h3>
<p>As expected, the highest-performing models are not the simplest. I keep the four best-performing models for the next stage.</p>
<p><br></p>
</div>
</div>
<div id="assessing-model-performance-with-the-holdout-data-set" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Assessing model performance with the holdout data set</h2>
<p>In this section I use data the models haven’t seen yet (the holdout data set). lin3 summary metrics are quite good, however again the curvature in the data is visible in the way the model is underestimating high and low radiance values:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="modeling-and-model-comparison.html#cb38-1" aria-hidden="true" tabindex="-1"></a>lin3_pred <span class="ot">&lt;-</span> lin3_wf <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="modeling-and-model-comparison.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict_on_holdout</span>(., train_split, holdout)</span>
<span id="cb38-3"><a href="modeling-and-model-comparison.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#predict_on_holdout(., train, holdout_df)</span></span>
<span id="cb38-4"><a href="modeling-and-model-comparison.html#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="modeling-and-model-comparison.html#cb38-5" aria-hidden="true" tabindex="-1"></a>lin3_metric_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb38-6"><a href="modeling-and-model-comparison.html#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(lin3_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred),</span>
<span id="cb38-7"><a href="modeling-and-model-comparison.html#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ccc</span>(lin3_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred)</span>
<span id="cb38-8"><a href="modeling-and-model-comparison.html#cb38-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="modeling-and-model-comparison.html#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(lin3_metric_summary<span class="sc">$</span>model))</span>
<span id="cb38-10"><a href="modeling-and-model-comparison.html#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="modeling-and-model-comparison.html#cb38-11" aria-hidden="true" tabindex="-1"></a>lin3_pred <span class="sc">%&gt;%</span> </span>
<span id="cb38-12"><a href="modeling-and-model-comparison.html#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(log_light_avg, .pred, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb38-13"><a href="modeling-and-model-comparison.html#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-14"><a href="modeling-and-model-comparison.html#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb38-15"><a href="modeling-and-model-comparison.html#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb38-16"><a href="modeling-and-model-comparison.html#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{lin3_metric_summary$model}&quot;</span>),</span>
<span id="cb38-17"><a href="modeling-and-model-comparison.html#cb38-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: &quot;</span>, </span>
<span id="cb38-18"><a href="modeling-and-model-comparison.html#cb38-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;{lin3_metric_summary[[2, 1]]} = {round(lin3_metric_summary[[2, 3]], 3)}&quot;</span>,</span>
<span id="cb38-19"><a href="modeling-and-model-comparison.html#cb38-19" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {lin3_metric_summary[[1, 1]]} = {round(lin3_metric_summary[[1, 3]], 3)}&quot;</span>)</span>
<span id="cb38-20"><a href="modeling-and-model-comparison.html#cb38-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:lin3-holdout"></span>
<img src="03-modeling_files/figure-html/lin3-holdout-1.png" alt="lin3 using holdout set" width="672" />
<p class="caption">
Figure 3.11: lin3 using holdout set
</p>
</div>
<p><br></p>
<p>pol1 looks good but is underestimating high radiance values:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="modeling-and-model-comparison.html#cb39-1" aria-hidden="true" tabindex="-1"></a>pol1_pred <span class="ot">&lt;-</span> pol1_wf <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="modeling-and-model-comparison.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict_on_holdout</span>(., train_split, holdout)</span>
<span id="cb39-3"><a href="modeling-and-model-comparison.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#predict_on_holdout(., train, holdout_df)</span></span>
<span id="cb39-4"><a href="modeling-and-model-comparison.html#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="modeling-and-model-comparison.html#cb39-5" aria-hidden="true" tabindex="-1"></a>pol1_metric_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb39-6"><a href="modeling-and-model-comparison.html#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(lin3_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred),</span>
<span id="cb39-7"><a href="modeling-and-model-comparison.html#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ccc</span>(lin3_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred)</span>
<span id="cb39-8"><a href="modeling-and-model-comparison.html#cb39-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb39-9"><a href="modeling-and-model-comparison.html#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(pol1_metric_summary<span class="sc">$</span>model))</span>
<span id="cb39-10"><a href="modeling-and-model-comparison.html#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="modeling-and-model-comparison.html#cb39-11" aria-hidden="true" tabindex="-1"></a>pol1_pred <span class="sc">%&gt;%</span> </span>
<span id="cb39-12"><a href="modeling-and-model-comparison.html#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(log_light_avg, .pred, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb39-13"><a href="modeling-and-model-comparison.html#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-14"><a href="modeling-and-model-comparison.html#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb39-15"><a href="modeling-and-model-comparison.html#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb39-16"><a href="modeling-and-model-comparison.html#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{pol1_metric_summary$model}&quot;</span>),</span>
<span id="cb39-17"><a href="modeling-and-model-comparison.html#cb39-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: &quot;</span>, </span>
<span id="cb39-18"><a href="modeling-and-model-comparison.html#cb39-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;{pol1_metric_summary[[2, 1]]} = {round(pol1_metric_summary[[2, 3]], 3)}&quot;</span>,</span>
<span id="cb39-19"><a href="modeling-and-model-comparison.html#cb39-19" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {pol1_metric_summary[[1, 1]]} = {round(pol1_metric_summary[[1, 3]], 3)}&quot;</span>)</span>
<span id="cb39-20"><a href="modeling-and-model-comparison.html#cb39-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:pol1-holdout"></span>
<img src="03-modeling_files/figure-html/pol1-holdout-1.png" alt="pol1 using holdout set" width="672" />
<p class="caption">
Figure 3.12: pol1 using holdout set
</p>
</div>
<p><br></p>
<p>Again lme1 fails to do better than lin3:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="modeling-and-model-comparison.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># error=TRUE to continue execution in case model fails to converge</span></span>
<span id="cb40-2"><a href="modeling-and-model-comparison.html#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="modeling-and-model-comparison.html#cb40-3" aria-hidden="true" tabindex="-1"></a>lme1_pred <span class="ot">&lt;-</span> lme1_wf <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="modeling-and-model-comparison.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict_on_holdout</span>(., train_split, holdout)</span>
<span id="cb40-5"><a href="modeling-and-model-comparison.html#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="modeling-and-model-comparison.html#cb40-6" aria-hidden="true" tabindex="-1"></a>lme1_metric_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb40-7"><a href="modeling-and-model-comparison.html#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(lme1_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred),</span>
<span id="cb40-8"><a href="modeling-and-model-comparison.html#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ccc</span>(lme1_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred)</span>
<span id="cb40-9"><a href="modeling-and-model-comparison.html#cb40-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb40-10"><a href="modeling-and-model-comparison.html#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(lme1_metric_summary<span class="sc">$</span>model))</span>
<span id="cb40-11"><a href="modeling-and-model-comparison.html#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="modeling-and-model-comparison.html#cb40-12" aria-hidden="true" tabindex="-1"></a>lme1_pred <span class="sc">%&gt;%</span> </span>
<span id="cb40-13"><a href="modeling-and-model-comparison.html#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(log_light_avg, .pred, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb40-14"><a href="modeling-and-model-comparison.html#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb40-15"><a href="modeling-and-model-comparison.html#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb40-16"><a href="modeling-and-model-comparison.html#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb40-17"><a href="modeling-and-model-comparison.html#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{lme1_metric_summary$model}&quot;</span>),</span>
<span id="cb40-18"><a href="modeling-and-model-comparison.html#cb40-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: &quot;</span>, </span>
<span id="cb40-19"><a href="modeling-and-model-comparison.html#cb40-19" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;{lme1_metric_summary[[2, 1]]} = {round(lme1_metric_summary[[2, 3]], 3)}&quot;</span>,</span>
<span id="cb40-20"><a href="modeling-and-model-comparison.html#cb40-20" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {lme1_metric_summary[[1, 1]]} = {round(lme1_metric_summary[[1, 3]], 3)}&quot;</span>)</span>
<span id="cb40-21"><a href="modeling-and-model-comparison.html#cb40-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:lme1-holdout"></span>
<img src="03-modeling_files/figure-html/lme1-holdout-1.png" alt="lme1 using holdout set" width="672" />
<p class="caption">
Figure 3.13: lme1 using holdout set
</p>
</div>
<p><br></p>
<p>Again bs1 is performing quite well:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="modeling-and-model-comparison.html#cb41-1" aria-hidden="true" tabindex="-1"></a>bs1_pred <span class="ot">&lt;-</span> bs_wf_best <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="modeling-and-model-comparison.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict_on_holdout</span>(., train_split, holdout)</span>
<span id="cb41-3"><a href="modeling-and-model-comparison.html#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="modeling-and-model-comparison.html#cb41-4" aria-hidden="true" tabindex="-1"></a>bs1_metric_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb41-5"><a href="modeling-and-model-comparison.html#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(bs1_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred),</span>
<span id="cb41-6"><a href="modeling-and-model-comparison.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ccc</span>(bs1_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred)</span>
<span id="cb41-7"><a href="modeling-and-model-comparison.html#cb41-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb41-8"><a href="modeling-and-model-comparison.html#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(bs1_metric_summary<span class="sc">$</span>model))</span>
<span id="cb41-9"><a href="modeling-and-model-comparison.html#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="modeling-and-model-comparison.html#cb41-10" aria-hidden="true" tabindex="-1"></a>bs1_pred <span class="sc">%&gt;%</span> </span>
<span id="cb41-11"><a href="modeling-and-model-comparison.html#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(log_light_avg, .pred, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb41-12"><a href="modeling-and-model-comparison.html#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb41-13"><a href="modeling-and-model-comparison.html#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb41-14"><a href="modeling-and-model-comparison.html#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb41-15"><a href="modeling-and-model-comparison.html#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{bs1_metric_summary$model}&quot;</span>),</span>
<span id="cb41-16"><a href="modeling-and-model-comparison.html#cb41-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: &quot;</span>, </span>
<span id="cb41-17"><a href="modeling-and-model-comparison.html#cb41-17" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;{bs1_metric_summary[[2, 1]]} = {round(bs1_metric_summary[[2, 3]], 3)}&quot;</span>,</span>
<span id="cb41-18"><a href="modeling-and-model-comparison.html#cb41-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {bs1_metric_summary[[1, 1]]} = {round(bs1_metric_summary[[1, 3]], 3)}&quot;</span>)</span>
<span id="cb41-19"><a href="modeling-and-model-comparison.html#cb41-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:bs1-holdout"></span>
<img src="03-modeling_files/figure-html/bs1-holdout-1.png" alt="bs1 using holdout set" width="672" />
<p class="caption">
Figure 3.14: bs1 using holdout set
</p>
</div>
<p><br></p>
<p>xg1 performance metrics are good, but the model is again underestimating at the high end:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="modeling-and-model-comparison.html#cb42-1" aria-hidden="true" tabindex="-1"></a>xg_pred <span class="ot">&lt;-</span> xg_fit_best <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="modeling-and-model-comparison.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict_on_holdout</span>(., train_split, holdout)</span>
<span id="cb42-3"><a href="modeling-and-model-comparison.html#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="modeling-and-model-comparison.html#cb42-4" aria-hidden="true" tabindex="-1"></a>xg1_metric_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb42-5"><a href="modeling-and-model-comparison.html#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(xg_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred),</span>
<span id="cb42-6"><a href="modeling-and-model-comparison.html#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ccc</span>(xg_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred)</span>
<span id="cb42-7"><a href="modeling-and-model-comparison.html#cb42-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb42-8"><a href="modeling-and-model-comparison.html#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(xg1_metric_summary<span class="sc">$</span>model))</span>
<span id="cb42-9"><a href="modeling-and-model-comparison.html#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="modeling-and-model-comparison.html#cb42-10" aria-hidden="true" tabindex="-1"></a>xg_pred <span class="sc">%&gt;%</span></span>
<span id="cb42-11"><a href="modeling-and-model-comparison.html#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(log_light_avg, .pred, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb42-12"><a href="modeling-and-model-comparison.html#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb42-13"><a href="modeling-and-model-comparison.html#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb42-14"><a href="modeling-and-model-comparison.html#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb42-15"><a href="modeling-and-model-comparison.html#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{xg1_metric_summary$model}&quot;</span>),</span>
<span id="cb42-16"><a href="modeling-and-model-comparison.html#cb42-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: &quot;</span>, </span>
<span id="cb42-17"><a href="modeling-and-model-comparison.html#cb42-17" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;{xg1_metric_summary[[2, 1]]} = {round(xg1_metric_summary[[2, 3]], 3)}&quot;</span>,</span>
<span id="cb42-18"><a href="modeling-and-model-comparison.html#cb42-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {xg1_metric_summary[[1, 1]]} = {round(xg1_metric_summary[[1, 3]], 3)}&quot;</span>)</span>
<span id="cb42-19"><a href="modeling-and-model-comparison.html#cb42-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:xg1-holdout"></span>
<img src="03-modeling_files/figure-html/xg1-holdout-1.png" alt="xg1 using holdout set" width="672" />
<p class="caption">
Figure 3.15: xg1 using holdout set
</p>
</div>
<p><br></p>
<div id="summary-model-evaluation-using-holdout-data-set" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Summary: model evaluation using holdout data set</h3>
<p>Results are similar for all models. The more sophisticated models perform slightly better, with the exception of the multi-level model lme1, which is not beating the very simple lin3. I exclude lme1 from the next stage.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="modeling-and-model-comparison.html#cb43-1" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb43-2"><a href="modeling-and-model-comparison.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  lin3_metric_summary,</span>
<span id="cb43-3"><a href="modeling-and-model-comparison.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  pol1_metric_summary,</span>
<span id="cb43-4"><a href="modeling-and-model-comparison.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  xg1_metric_summary,</span>
<span id="cb43-5"><a href="modeling-and-model-comparison.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  lme1_metric_summary,</span>
<span id="cb43-6"><a href="modeling-and-model-comparison.html#cb43-6" aria-hidden="true" tabindex="-1"></a>  bs1_metric_summary</span>
<span id="cb43-7"><a href="modeling-and-model-comparison.html#cb43-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-8"><a href="modeling-and-model-comparison.html#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="modeling-and-model-comparison.html#cb43-9" aria-hidden="true" tabindex="-1"></a>model_levels <span class="ot">=</span> all_metrics <span class="sc">%&gt;%</span></span>
<span id="cb43-10"><a href="modeling-and-model-comparison.html#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;ccc&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-11"><a href="modeling-and-model-comparison.html#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(.estimate) <span class="sc">%&gt;%</span></span>
<span id="cb43-12"><a href="modeling-and-model-comparison.html#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(model)</span>
<span id="cb43-13"><a href="modeling-and-model-comparison.html#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="modeling-and-model-comparison.html#cb43-14" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="sc">%&gt;%</span></span>
<span id="cb43-15"><a href="modeling-and-model-comparison.html#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_levels)) <span class="sc">%&gt;%</span></span>
<span id="cb43-16"><a href="modeling-and-model-comparison.html#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(.estimate, model)) <span class="sc">+</span></span>
<span id="cb43-17"><a href="modeling-and-model-comparison.html#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb43-18"><a href="modeling-and-model-comparison.html#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_pad</span>(<span class="fu">round</span>(.estimate, <span class="dv">3</span>), </span>
<span id="cb43-19"><a href="modeling-and-model-comparison.html#cb43-19" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">width =</span> <span class="dv">5</span>, <span class="at">side =</span> <span class="st">&quot;right&quot;</span>, <span class="at">pad =</span> <span class="st">&quot;0&quot;</span>)</span>
<span id="cb43-20"><a href="modeling-and-model-comparison.html#cb43-20" aria-hidden="true" tabindex="-1"></a>                 ),</span>
<span id="cb43-21"><a href="modeling-and-model-comparison.html#cb43-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_x =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb43-22"><a href="modeling-and-model-comparison.html#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb43-23"><a href="modeling-and-model-comparison.html#cb43-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> .metric, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-24"><a href="modeling-and-model-comparison.html#cb43-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb43-25"><a href="modeling-and-model-comparison.html#cb43-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-26"><a href="modeling-and-model-comparison.html#cb43-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Model evaluation on holdout data set&quot;</span>,</span>
<span id="cb43-27"><a href="modeling-and-model-comparison.html#cb43-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;metric estimate&quot;</span>,</span>
<span id="cb43-28"><a href="modeling-and-model-comparison.html#cb43-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:summary-holdout-plot"></span>
<img src="03-modeling_files/figure-html/summary-holdout-plot-1.png" alt="Summary of holdout results" width="768" />
<p class="caption">
Figure 3.16: Summary of holdout results
</p>
</div>
<p><br></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="modeling-and-model-comparison.html#cb44-1" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="modeling-and-model-comparison.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>.estimator) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="modeling-and-model-comparison.html#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(.metric, <span class="fu">desc</span>(.estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="modeling-and-model-comparison.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="modeling-and-model-comparison.html#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb44-6"><a href="modeling-and-model-comparison.html#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="fu">md</span>(<span class="st">&quot;**Model evaluation on holdout data set**&quot;</span>)</span>
<span id="cb44-7"><a href="modeling-and-model-comparison.html#cb44-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb44-8"><a href="modeling-and-model-comparison.html#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> .estimate,</span>
<span id="cb44-9"><a href="modeling-and-model-comparison.html#cb44-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">decimals =</span> <span class="dv">3</span>)</span></code></pre></div>
<div id="arqpwajcvt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#arqpwajcvt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#arqpwajcvt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#arqpwajcvt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#arqpwajcvt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#arqpwajcvt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#arqpwajcvt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#arqpwajcvt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#arqpwajcvt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#arqpwajcvt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#arqpwajcvt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#arqpwajcvt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#arqpwajcvt .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#arqpwajcvt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#arqpwajcvt .gt_from_md > :first-child {
  margin-top: 0;
}

#arqpwajcvt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#arqpwajcvt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#arqpwajcvt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#arqpwajcvt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#arqpwajcvt .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#arqpwajcvt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#arqpwajcvt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#arqpwajcvt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#arqpwajcvt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#arqpwajcvt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#arqpwajcvt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#arqpwajcvt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#arqpwajcvt .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#arqpwajcvt .gt_left {
  text-align: left;
}

#arqpwajcvt .gt_center {
  text-align: center;
}

#arqpwajcvt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#arqpwajcvt .gt_font_normal {
  font-weight: normal;
}

#arqpwajcvt .gt_font_bold {
  font-weight: bold;
}

#arqpwajcvt .gt_font_italic {
  font-style: italic;
}

#arqpwajcvt .gt_super {
  font-size: 65%;
}

#arqpwajcvt .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border" style><strong>Model evaluation on holdout data set</strong></th>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.metric</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">model</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.975</td>
<td class="gt_row gt_left">bs1: log_light_avg ~ bs(log_pop_density)</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.963</td>
<td class="gt_row gt_left">xg1: log_light_avg ~ log_pop_density + state</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.962</td>
<td class="gt_row gt_left">lin3: log_light_avg ~ log_pop_density</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.962</td>
<td class="gt_row gt_left">pol1: log_light_avg ~ poly(log_pop_density, 2)</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.958</td>
<td class="gt_row gt_left">lme1: log_light_avg ~ log_pop_density + (log_pop_density | state)</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.961</td>
<td class="gt_row gt_left">bs1: log_light_avg ~ bs(log_pop_density)</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.957</td>
<td class="gt_row gt_left">xg1: log_light_avg ~ log_pop_density + state</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.937</td>
<td class="gt_row gt_left">lin3: log_light_avg ~ log_pop_density</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.937</td>
<td class="gt_row gt_left">pol1: log_light_avg ~ poly(log_pop_density, 2)</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.937</td>
<td class="gt_row gt_left">lme1: log_light_avg ~ log_pop_density + (log_pop_density | state)</td></tr>
  </tbody>
  
  
</table>
</div>
<p><br></p>
</div>
</div>
<div id="comparing-2000-and-2010" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Comparing 2000 and 2010</h2>
<p>I use the four top-performing models to predict changes in average radiance in 2010 given population density in 2010.</p>
<p><strong><em>TODO: Review/update the commentary</em></strong></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="modeling-and-model-comparison.html#cb45-1" aria-hidden="true" tabindex="-1"></a>data_df_c <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(all_df_c) <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="modeling-and-model-comparison.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#fix NAs</span></span>
<span id="cb45-3"><a href="modeling-and-model-comparison.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">atotal =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(atotal), atotal, calc_area),</span>
<span id="cb45-4"><a href="modeling-and-model-comparison.html#cb45-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pop_density_official =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(pop_density_official), pop_density_official, pop_density)) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="modeling-and-model-comparison.html#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># drop apparent data errors/artifacts</span></span>
<span id="cb45-6"><a href="modeling-and-model-comparison.html#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(light_avg <span class="sc">&gt;</span> <span class="fl">1e-5</span>)</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="modeling-and-model-comparison.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data for train-test and holdout</span></span>
<span id="cb46-2"><a href="modeling-and-model-comparison.html#cb46-2" aria-hidden="true" tabindex="-1"></a>d_df_c <span class="ot">&lt;-</span> data_df_c <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="modeling-and-model-comparison.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(state<span class="sc">:</span>pop_density_official) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="modeling-and-model-comparison.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_diff_pct =</span> <span class="dv">1</span> <span class="sc">-</span> calc_area <span class="sc">/</span> atotal,</span>
<span id="cb46-5"><a href="modeling-and-model-comparison.html#cb46-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">pop_densisty_diff_pct =</span> <span class="dv">1</span> <span class="sc">-</span> pop_density <span class="sc">/</span> pop_density_official)</span>
<span id="cb46-6"><a href="modeling-and-model-comparison.html#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="modeling-and-model-comparison.html#cb46-7" aria-hidden="true" tabindex="-1"></a>assess_df <span class="ot">&lt;-</span> d_df_c <span class="sc">%&gt;%</span></span>
<span id="cb46-8"><a href="modeling-and-model-comparison.html#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># avoid zero values</span></span>
<span id="cb46-9"><a href="modeling-and-model-comparison.html#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_light_avg =</span> <span class="fu">log10</span>(light_avg <span class="sc">+</span> <span class="fl">1e-6</span>),</span>
<span id="cb46-10"><a href="modeling-and-model-comparison.html#cb46-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_pop_density =</span> <span class="fu">log10</span>(pop_density <span class="sc">+</span> <span class="fl">1e-6</span>),</span>
<span id="cb46-11"><a href="modeling-and-model-comparison.html#cb46-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_pop_density_official =</span> <span class="fu">log10</span>(pop_density_official <span class="sc">+</span> <span class="fl">1e-6</span>))</span>
<span id="cb46-12"><a href="modeling-and-model-comparison.html#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="modeling-and-model-comparison.html#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2021</span>)</span></code></pre></div>
<p>lin3 looks pretty good but underestimates high 2010 radiance values.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="modeling-and-model-comparison.html#cb47-1" aria-hidden="true" tabindex="-1"></a>lin3_pred <span class="ot">&lt;-</span> lin3_wf <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="modeling-and-model-comparison.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict_on_holdout</span>(., holdout, assess_df)</span>
<span id="cb47-3"><a href="modeling-and-model-comparison.html#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="modeling-and-model-comparison.html#cb47-4" aria-hidden="true" tabindex="-1"></a>lin3_metric_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb47-5"><a href="modeling-and-model-comparison.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(lin3_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred),</span>
<span id="cb47-6"><a href="modeling-and-model-comparison.html#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ccc</span>(lin3_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred)</span>
<span id="cb47-7"><a href="modeling-and-model-comparison.html#cb47-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="modeling-and-model-comparison.html#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(lin3_metric_summary<span class="sc">$</span>model))</span>
<span id="cb47-9"><a href="modeling-and-model-comparison.html#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="modeling-and-model-comparison.html#cb47-10" aria-hidden="true" tabindex="-1"></a>lin3_pred <span class="sc">%&gt;%</span> </span>
<span id="cb47-11"><a href="modeling-and-model-comparison.html#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(log_light_avg, .pred, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb47-12"><a href="modeling-and-model-comparison.html#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb47-13"><a href="modeling-and-model-comparison.html#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb47-14"><a href="modeling-and-model-comparison.html#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb47-15"><a href="modeling-and-model-comparison.html#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{lin3_metric_summary$model}&quot;</span>),</span>
<span id="cb47-16"><a href="modeling-and-model-comparison.html#cb47-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: &quot;</span>, </span>
<span id="cb47-17"><a href="modeling-and-model-comparison.html#cb47-17" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;{lin3_metric_summary[[2, 1]]} = {round(lin3_metric_summary[[2, 3]], 3)}&quot;</span>,</span>
<span id="cb47-18"><a href="modeling-and-model-comparison.html#cb47-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {lin3_metric_summary[[1, 1]]} = {round(lin3_metric_summary[[1, 3]], 3)}&quot;</span>)</span>
<span id="cb47-19"><a href="modeling-and-model-comparison.html#cb47-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:lin3-assess"></span>
<img src="03-modeling_files/figure-html/lin3-assess-1.png" alt="lin1 assess set results" width="672" />
<p class="caption">
Figure 3.17: lin1 assess set results
</p>
</div>
<p><br></p>
<p>pol1 is overestimating low 2010 radiance values and underestimating most other values:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="modeling-and-model-comparison.html#cb48-1" aria-hidden="true" tabindex="-1"></a>pol1_pred <span class="ot">&lt;-</span> pol1_wf <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="modeling-and-model-comparison.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict_on_holdout</span>(., holdout, assess_df)</span>
<span id="cb48-3"><a href="modeling-and-model-comparison.html#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="modeling-and-model-comparison.html#cb48-4" aria-hidden="true" tabindex="-1"></a>pol1_metric_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb48-5"><a href="modeling-and-model-comparison.html#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(lin3_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred),</span>
<span id="cb48-6"><a href="modeling-and-model-comparison.html#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ccc</span>(lin3_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred)</span>
<span id="cb48-7"><a href="modeling-and-model-comparison.html#cb48-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="modeling-and-model-comparison.html#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(pol1_metric_summary<span class="sc">$</span>model))</span>
<span id="cb48-9"><a href="modeling-and-model-comparison.html#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="modeling-and-model-comparison.html#cb48-10" aria-hidden="true" tabindex="-1"></a>pol1_pred <span class="sc">%&gt;%</span> </span>
<span id="cb48-11"><a href="modeling-and-model-comparison.html#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(log_light_avg, .pred, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb48-12"><a href="modeling-and-model-comparison.html#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb48-13"><a href="modeling-and-model-comparison.html#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb48-14"><a href="modeling-and-model-comparison.html#cb48-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb48-15"><a href="modeling-and-model-comparison.html#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{pol1_metric_summary$model}&quot;</span>),</span>
<span id="cb48-16"><a href="modeling-and-model-comparison.html#cb48-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: &quot;</span>, </span>
<span id="cb48-17"><a href="modeling-and-model-comparison.html#cb48-17" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;{pol1_metric_summary[[2, 1]]} = {round(pol1_metric_summary[[2, 3]], 3)}&quot;</span>,</span>
<span id="cb48-18"><a href="modeling-and-model-comparison.html#cb48-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {pol1_metric_summary[[1, 1]]} = {round(pol1_metric_summary[[1, 3]], 3)}&quot;</span>)</span>
<span id="cb48-19"><a href="modeling-and-model-comparison.html#cb48-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:pol1-assess"></span>
<img src="03-modeling_files/figure-html/pol1-assess-1.png" alt="pol1 assess set results" width="672" />
<p class="caption">
Figure 3.18: pol1 assess set results
</p>
</div>
<p><br></p>
<p>Like pol1, bs1 is overestimating low 2010 radiance values and underestimating most other values:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="modeling-and-model-comparison.html#cb49-1" aria-hidden="true" tabindex="-1"></a>bs1_pred <span class="ot">&lt;-</span> bs_wf_best <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="modeling-and-model-comparison.html#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict_on_holdout</span>(., holdout, assess_df)</span>
<span id="cb49-3"><a href="modeling-and-model-comparison.html#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="modeling-and-model-comparison.html#cb49-4" aria-hidden="true" tabindex="-1"></a>bs1_metric_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb49-5"><a href="modeling-and-model-comparison.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(bs1_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred),</span>
<span id="cb49-6"><a href="modeling-and-model-comparison.html#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ccc</span>(bs1_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred)</span>
<span id="cb49-7"><a href="modeling-and-model-comparison.html#cb49-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb49-8"><a href="modeling-and-model-comparison.html#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(bs1_metric_summary<span class="sc">$</span>model))</span>
<span id="cb49-9"><a href="modeling-and-model-comparison.html#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="modeling-and-model-comparison.html#cb49-10" aria-hidden="true" tabindex="-1"></a>bs1_pred <span class="sc">%&gt;%</span> </span>
<span id="cb49-11"><a href="modeling-and-model-comparison.html#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(log_light_avg, .pred, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb49-12"><a href="modeling-and-model-comparison.html#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb49-13"><a href="modeling-and-model-comparison.html#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb49-14"><a href="modeling-and-model-comparison.html#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb49-15"><a href="modeling-and-model-comparison.html#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{bs1_metric_summary$model}&quot;</span>),</span>
<span id="cb49-16"><a href="modeling-and-model-comparison.html#cb49-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: &quot;</span>, </span>
<span id="cb49-17"><a href="modeling-and-model-comparison.html#cb49-17" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;{bs1_metric_summary[[2, 1]]} = {round(bs1_metric_summary[[2, 3]], 3)}&quot;</span>,</span>
<span id="cb49-18"><a href="modeling-and-model-comparison.html#cb49-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {bs1_metric_summary[[1, 1]]} = {round(bs1_metric_summary[[1, 3]], 3)}&quot;</span>)</span>
<span id="cb49-19"><a href="modeling-and-model-comparison.html#cb49-19" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb49-20"><a href="modeling-and-model-comparison.html#cb49-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:bs1-assess"></span>
<img src="03-modeling_files/figure-html/bs1-assess-1.png" alt="bs1 assess set results" width="672" />
<p class="caption">
Figure 3.19: bs1 assess set results
</p>
</div>
<p><br></p>
<p>xg1 is under-predicting most values:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="modeling-and-model-comparison.html#cb50-1" aria-hidden="true" tabindex="-1"></a>xg_pred <span class="ot">&lt;-</span> xg_fit_best <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="modeling-and-model-comparison.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict_on_holdout</span>(., holdout, assess_df)</span>
<span id="cb50-3"><a href="modeling-and-model-comparison.html#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="modeling-and-model-comparison.html#cb50-4" aria-hidden="true" tabindex="-1"></a>xg1_metric_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb50-5"><a href="modeling-and-model-comparison.html#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(xg_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred),</span>
<span id="cb50-6"><a href="modeling-and-model-comparison.html#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ccc</span>(xg_pred, <span class="at">truth =</span> log_light_avg, <span class="at">estimate =</span> .pred)</span>
<span id="cb50-7"><a href="modeling-and-model-comparison.html#cb50-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb50-8"><a href="modeling-and-model-comparison.html#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(xg1_metric_summary<span class="sc">$</span>model))</span>
<span id="cb50-9"><a href="modeling-and-model-comparison.html#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="modeling-and-model-comparison.html#cb50-10" aria-hidden="true" tabindex="-1"></a>xg_pred <span class="sc">%&gt;%</span></span>
<span id="cb50-11"><a href="modeling-and-model-comparison.html#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(log_light_avg, .pred, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb50-12"><a href="modeling-and-model-comparison.html#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb50-13"><a href="modeling-and-model-comparison.html#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb50-14"><a href="modeling-and-model-comparison.html#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb50-15"><a href="modeling-and-model-comparison.html#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{xg1_metric_summary$model}&quot;</span>),</span>
<span id="cb50-16"><a href="modeling-and-model-comparison.html#cb50-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Actual and predicted light_avg: &quot;</span>, </span>
<span id="cb50-17"><a href="modeling-and-model-comparison.html#cb50-17" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;{xg1_metric_summary[[2, 1]]} = {round(xg1_metric_summary[[2, 3]], 3)}&quot;</span>,</span>
<span id="cb50-18"><a href="modeling-and-model-comparison.html#cb50-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;; {xg1_metric_summary[[1, 1]]} = {round(xg1_metric_summary[[1, 3]], 3)}&quot;</span>)</span>
<span id="cb50-19"><a href="modeling-and-model-comparison.html#cb50-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:xg1-assess"></span>
<img src="03-modeling_files/figure-html/xg1-assess-1.png" alt="xg1 assess set results" width="672" />
<p class="caption">
Figure 3.20: xg1 assess set results
</p>
</div>
<p><br></p>
<div id="summary-model-performance-on-census-2010-data." class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Summary: model performance on census 2010 data.</h3>
<p>The simpler models do better: lin3, pol1, and bs1 are essentially equal in performance while xg1 does worse and underestimates most radiance values.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="modeling-and-model-comparison.html#cb51-1" aria-hidden="true" tabindex="-1"></a>all_means <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb51-2"><a href="modeling-and-model-comparison.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(lin3_pred, <span class="fu">t.test</span>(.pred, log_light_avg, <span class="at">paired =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="modeling-and-model-comparison.html#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(lin3_metric_summary<span class="sc">$</span>model)),</span>
<span id="cb51-4"><a href="modeling-and-model-comparison.html#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(xg1_pred, <span class="fu">t.test</span>(.pred, log_light_avg, <span class="at">paired =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-5"><a href="modeling-and-model-comparison.html#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(xg1_metric_summary<span class="sc">$</span>model)),</span>
<span id="cb51-6"><a href="modeling-and-model-comparison.html#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(pol1_pred, <span class="fu">t.test</span>(.pred, log_light_avg, <span class="at">paired =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-7"><a href="modeling-and-model-comparison.html#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(pol1_metric_summary<span class="sc">$</span>model)),</span>
<span id="cb51-8"><a href="modeling-and-model-comparison.html#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(bs1_pred, <span class="fu">t.test</span>(.pred, log_light_avg, <span class="at">paired =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-9"><a href="modeling-and-model-comparison.html#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">unique</span>(bs1_metric_summary<span class="sc">$</span>model))</span>
<span id="cb51-10"><a href="modeling-and-model-comparison.html#cb51-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb51-11"><a href="modeling-and-model-comparison.html#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">diff_in_means =</span> estimate) <span class="sc">%&gt;%</span></span>
<span id="cb51-12"><a href="modeling-and-model-comparison.html#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(diff_in_means))) <span class="sc">%&gt;%</span></span>
<span id="cb51-13"><a href="modeling-and-model-comparison.html#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">as_factor</span>(model)) <span class="co"># creates levels with current ordering</span></span>
<span id="cb51-14"><a href="modeling-and-model-comparison.html#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="modeling-and-model-comparison.html#cb51-15" aria-hidden="true" tabindex="-1"></a>all_means <span class="sc">%&gt;%</span></span>
<span id="cb51-16"><a href="modeling-and-model-comparison.html#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(diff_in_means, model)) <span class="sc">+</span></span>
<span id="cb51-17"><a href="modeling-and-model-comparison.html#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high, <span class="at">height =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb51-18"><a href="modeling-and-model-comparison.html#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb51-19"><a href="modeling-and-model-comparison.html#cb51-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb51-20"><a href="modeling-and-model-comparison.html#cb51-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-21"><a href="modeling-and-model-comparison.html#cb51-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Difference in means between predicted and</span><span class="sc">\n</span><span class="st">actual log_light_avg&quot;</span>,</span>
<span id="cb51-22"><a href="modeling-and-model-comparison.html#cb51-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;T-test at 95% CI&quot;</span>,</span>
<span id="cb51-23"><a href="modeling-and-model-comparison.html#cb51-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;difference in means&quot;</span>,</span>
<span id="cb51-24"><a href="modeling-and-model-comparison.html#cb51-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:summary-assess-mean-differences-plot"></span>
<img src="03-modeling_files/figure-html/summary-assess-mean-differences-plot-1.png" alt="Differences in the means (predicted v actual)" width="768" />
<p class="caption">
Figure 3.21: Differences in the means (predicted v actual)
</p>
</div>
<p><br></p>
<p><strong><em>TODO: write summary statement re: metrics</em></strong></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="modeling-and-model-comparison.html#cb52-1" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb52-2"><a href="modeling-and-model-comparison.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  lin3_metric_summary,</span>
<span id="cb52-3"><a href="modeling-and-model-comparison.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  pol1_metric_summary,</span>
<span id="cb52-4"><a href="modeling-and-model-comparison.html#cb52-4" aria-hidden="true" tabindex="-1"></a>  xg1_metric_summary,</span>
<span id="cb52-5"><a href="modeling-and-model-comparison.html#cb52-5" aria-hidden="true" tabindex="-1"></a>  bs1_metric_summary</span>
<span id="cb52-6"><a href="modeling-and-model-comparison.html#cb52-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-7"><a href="modeling-and-model-comparison.html#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="modeling-and-model-comparison.html#cb52-8" aria-hidden="true" tabindex="-1"></a>model_levels <span class="ot">=</span> all_metrics <span class="sc">%&gt;%</span></span>
<span id="cb52-9"><a href="modeling-and-model-comparison.html#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;ccc&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="modeling-and-model-comparison.html#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(.estimate) <span class="sc">%&gt;%</span></span>
<span id="cb52-11"><a href="modeling-and-model-comparison.html#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(model)</span>
<span id="cb52-12"><a href="modeling-and-model-comparison.html#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="modeling-and-model-comparison.html#cb52-13" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="sc">%&gt;%</span></span>
<span id="cb52-14"><a href="modeling-and-model-comparison.html#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_levels)) <span class="sc">%&gt;%</span></span>
<span id="cb52-15"><a href="modeling-and-model-comparison.html#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(.estimate, model)) <span class="sc">+</span></span>
<span id="cb52-16"><a href="modeling-and-model-comparison.html#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb52-17"><a href="modeling-and-model-comparison.html#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_pad</span>(<span class="fu">round</span>(.estimate, <span class="dv">3</span>), </span>
<span id="cb52-18"><a href="modeling-and-model-comparison.html#cb52-18" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">width =</span> <span class="dv">5</span>, <span class="at">side =</span> <span class="st">&quot;right&quot;</span>, <span class="at">pad =</span> <span class="st">&quot;0&quot;</span>)</span>
<span id="cb52-19"><a href="modeling-and-model-comparison.html#cb52-19" aria-hidden="true" tabindex="-1"></a>                 ),</span>
<span id="cb52-20"><a href="modeling-and-model-comparison.html#cb52-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_x =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb52-21"><a href="modeling-and-model-comparison.html#cb52-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb52-22"><a href="modeling-and-model-comparison.html#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> .metric, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-23"><a href="modeling-and-model-comparison.html#cb52-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb52-24"><a href="modeling-and-model-comparison.html#cb52-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-25"><a href="modeling-and-model-comparison.html#cb52-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Model evaluation on holdout data set&quot;</span>,</span>
<span id="cb52-26"><a href="modeling-and-model-comparison.html#cb52-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;metric estimate&quot;</span>,</span>
<span id="cb52-27"><a href="modeling-and-model-comparison.html#cb52-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:summary-assess-plot"></span>
<img src="03-modeling_files/figure-html/summary-assess-plot-1.png" alt="Holdout set results" width="768" />
<p class="caption">
Figure 3.22: Holdout set results
</p>
</div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="modeling-and-model-comparison.html#cb53-1" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="modeling-and-model-comparison.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>.estimator) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="modeling-and-model-comparison.html#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(.metric, <span class="fu">desc</span>(.estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="modeling-and-model-comparison.html#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="modeling-and-model-comparison.html#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb53-6"><a href="modeling-and-model-comparison.html#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="fu">md</span>(<span class="st">&quot;**Model evaluation on holdout data set**&quot;</span>)</span>
<span id="cb53-7"><a href="modeling-and-model-comparison.html#cb53-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb53-8"><a href="modeling-and-model-comparison.html#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(.estimate),</span>
<span id="cb53-9"><a href="modeling-and-model-comparison.html#cb53-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">decimals =</span> <span class="dv">3</span>)</span></code></pre></div>
<div id="ddhmidilky" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ddhmidilky .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ddhmidilky .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ddhmidilky .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ddhmidilky .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ddhmidilky .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ddhmidilky .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ddhmidilky .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ddhmidilky .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ddhmidilky .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ddhmidilky .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ddhmidilky .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ddhmidilky .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ddhmidilky .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ddhmidilky .gt_from_md > :first-child {
  margin-top: 0;
}

#ddhmidilky .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ddhmidilky .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ddhmidilky .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#ddhmidilky .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddhmidilky .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#ddhmidilky .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddhmidilky .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ddhmidilky .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ddhmidilky .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ddhmidilky .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ddhmidilky .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#ddhmidilky .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ddhmidilky .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#ddhmidilky .gt_left {
  text-align: left;
}

#ddhmidilky .gt_center {
  text-align: center;
}

#ddhmidilky .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ddhmidilky .gt_font_normal {
  font-weight: normal;
}

#ddhmidilky .gt_font_bold {
  font-weight: bold;
}

#ddhmidilky .gt_font_italic {
  font-style: italic;
}

#ddhmidilky .gt_super {
  font-size: 65%;
}

#ddhmidilky .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border" style><strong>Model evaluation on holdout data set</strong></th>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.metric</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">model</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.962</td>
<td class="gt_row gt_left">lin3: log_light_avg ~ log_pop_density</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.962</td>
<td class="gt_row gt_left">pol1: log_light_avg ~ poly(log_pop_density, 2)</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.959</td>
<td class="gt_row gt_left">bs1: log_light_avg ~ bs(log_pop_density)</td></tr>
    <tr><td class="gt_row gt_left">ccc</td>
<td class="gt_row gt_right">0.935</td>
<td class="gt_row gt_left">xg1: log_light_avg ~ log_pop_density + state</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.945</td>
<td class="gt_row gt_left">lin3: log_light_avg ~ log_pop_density</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.945</td>
<td class="gt_row gt_left">pol1: log_light_avg ~ poly(log_pop_density, 2)</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.939</td>
<td class="gt_row gt_left">xg1: log_light_avg ~ log_pop_density + state</td></tr>
    <tr><td class="gt_row gt_left">rsq</td>
<td class="gt_row gt_right">0.935</td>
<td class="gt_row gt_left">bs1: log_light_avg ~ bs(log_pop_density)</td></tr>
  </tbody>
  
  
</table>
</div>

<!-- 04-interpretration.Rmd -->
<!-- this is a child doc of index.Rmd -->
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exploratory-data-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="interpreting-the-results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
